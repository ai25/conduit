import{createComponent as o,isServer as M,getRequestEvent as J,delegateEvents as kt,ssrElement as Q,escape as l,mergeProps as N,ssr as h,Portal as oe,ssrHydrationKey as v,ssrAttribute as C,ssrClassList as Ct,useAssets as Rt,NoHydration as Qe,HydrationScript as Pt,Hydration as Et,renderToString as Tt,renderToStream as It}from"solid-js/web";import{children as At,createMemo as X,getOwner as Ot,untrack as Xe,Show as I,on as Ze,createRoot as Lt,createSignal as x,onCleanup as _,lazy as _t,createComponent as Dt,createContext as ae,createEffect as R,splitProps as q,useContext as Ce,createUniqueId as Re,For as B,onMount as Pe,Switch as Mt,Match as Y,createRenderEffect as Nt,Suspense as Le,ErrorBoundary as et,sharedConfig as me}from"solid-js";import{u as Ft,m as U,P as Ee,a as qt,b as Ht,c as jt,M as Ut,d as zt,e as Kt,f as Bt,g as Wt,h as Vt,D as Gt,i as be,j as Jt,k as Yt,l as Qt,n as tt,o as he,p as Xt,B as Zt,q as _e,r as er,s as tr,t as rr,v as nr,w as sr,T as or,x as ar,y as ir,z as lr,A as ie,C as V,E as Te,F as cr,G as ur,V as dr,H as pr,I as fr,J as mr,K as hr,L as rt,N as gr,O as vr,Q as br,R as yr,S as wr,U as xr,W as $r,X as Sr}from"./assets/syncStore-DaflpWzS.js";import{createStore as nt}from"solid-js/store";import{u as Z,L as ye,A as kr}from"./assets/Link-ClDVT-6o.js";import{I as le}from"./assets/index-wr7A5cEE.js";import{createQuery as st,QueryClient as Cr,QueryClientProvider as Rr,isServer as Pr}from"@tanstack/solid-query";import{F as Er,a as Tr,b as Ir,c as Ar}from"./assets/index-BPtxG8PX.js";import{T as ot,a as Or,b as Lr,c as De,B as _r,d as Dr,e as Mr}from"./assets/index-Bhsy5eyg.js";import{c as Nr,a as Fr,R as qr,b as Hr,d as jr,g as Me,m as Ur,k as zr,s as Kr,e as Br,n as Wr,u as Ie,f as Ae,h as at,i as Vr}from"./assets/routing-CB9zsxEG.js";import{F as ge}from"./assets/Field-D-TYCh3e.js";import{M as Gr}from"./assets/index-BIuKkAdd.js";import{provideRequestEvent as Jr}from"solid-js/web/storage";import{H3Event as we,setResponseStatus as Yr,sendRedirect as Qr,setHeader as Xr,getRequestIP as Zr,getResponseStatus as en,getResponseStatusText as tn,getCookie as rn,setCookie as nn,getRequestURL as sn,getResponseHeaders as on,getResponseHeader as an,setResponseHeader as ln,appendResponseHeader as cn,removeResponseHeader as un,getRequestWebStream as dn,eventHandler as pn}from"h3";import{AsyncLocalStorage as fn}from"node:async_hooks";import"y-webrtc";import"yjs";import"lib0/observable";import"numeral";import"@solid-primitives/date";import"./assets/components-Bl9pqdE7.js";const it=e=>r=>{const{base:t}=r,n=At(()=>r.children),s=X(()=>Nr(n(),r.base||""));let i;const a=Fr(e,s,()=>i,{base:t,singleFlight:r.singleFlight});return e.create&&e.create(a),o(qr.Provider,{value:a,get children(){return o(mn,{routerState:a,get root(){return r.root},get load(){return r.rootLoad},get children(){return[(i=Ot())&&null,o(hn,{routerState:a,get branches(){return s()}})]}})}})};function mn(e){const r=e.routerState.location,t=e.routerState.params,n=X(()=>e.load&&Xe(()=>e.load({params:t,location:r,intent:"preload"})));return o(I,{get when(){return e.root},keyed:!0,get fallback(){return e.children},children:s=>o(s,{params:t,location:r,get data(){return n()},get children(){return e.children}})})}function hn(e){if(M){const s=J();if(s&&s.router&&s.router.dataOnly){gn(s,e.routerState,e.branches);return}s&&((s.router||(s.router={})).matches||(s.router.matches=e.routerState.matches().map(({route:i,path:a,params:c})=>({path:i.originalPath,pattern:i.pattern,match:a,params:c,info:i.info}))))}const r=[];let t;const n=X(Ze(e.routerState.matches,(s,i,a)=>{let c=i&&s.length===i.length;const u=[];for(let d=0,b=s.length;d<b;d++){const S=i&&i[d],g=s[d];a&&S&&g.route.key===S.route.key?u[d]=a[d]:(c=!1,r[d]&&r[d](),Lt(f=>{r[d]=f,u[d]=Hr(e.routerState,u[d-1]||e.routerState.base,Ne(()=>n()[d+1]),()=>e.routerState.matches()[d])}))}return r.splice(s.length).forEach(d=>d()),a&&c?a:(t=u[0],u)}));return Ne(()=>n()&&t)()}const Ne=e=>()=>o(I,{get when(){return e()},keyed:!0,children:r=>o(jr.Provider,{value:r,get children(){return r.outlet()}})});function gn(e,r,t){const n=new URL(e.request.url),s=Me(t,new URL(e.router.previousUrl||e.request.url).pathname),i=Me(t,n.pathname);for(let a=0;a<i.length;a++){(!s[a]||i[a].route!==s[a].route)&&(e.router.dataOnly=!0);const{route:c,params:u}=i[a];c.load&&c.load({params:u,location:r.location,intent:"preload"})}}function vn([e,r],t,n){return[t?()=>t(e()):e,n?s=>r(n(s)):r]}function bn(e){if(e==="#")return null;try{return document.querySelector(e)}catch{return null}}function yn(e){let r=!1;const t=s=>typeof s=="string"?{value:s}:s,n=vn(x(t(e.get()),{equals:(s,i)=>s.value===i.value}),void 0,s=>(!r&&e.set(s),s));return e.init&&_(e.init((s=e.get())=>{r=!0,n[1](t(s)),r=!1})),it({signal:n,create:e.create,utils:e.utils})}function wn(e,r,t){return e.addEventListener(r,t),()=>e.removeEventListener(r,t)}function xn(e,r){const t=bn(`#${e}`);t?t.scrollIntoView():r&&window.scrollTo(0,0)}function $n(e){const r=new URL(e);return r.pathname+r.search}function Sn(e){let r;const t={value:e.url||(r=J())&&$n(r.request.url)||""};return it({signal:[()=>t,n=>Object.assign(t,n)]})(e)}const kn=new Map;function Cn(e=!0,r=!1,t="/_server"){return n=>{const s=n.base.path(),i=n.navigatorFactory(n.base);let a={};function c(m){return m.namespaceURI==="http://www.w3.org/2000/svg"}function u(m){if(m.defaultPrevented||m.button!==0||m.metaKey||m.altKey||m.ctrlKey||m.shiftKey)return;const w=m.composedPath().find(O=>O instanceof Node&&O.nodeName.toUpperCase()==="A");if(!w||r&&!w.hasAttribute("link"))return;const $=c(w),k=$?w.href.baseVal:w.href;if(($?w.target.baseVal:w.target)||!k&&!w.hasAttribute("state"))return;const P=(w.getAttribute("rel")||"").split(/\s+/);if(w.hasAttribute("download")||P&&P.includes("external"))return;const L=$?new URL(k,document.baseURI):new URL(k);if(!(L.origin!==window.location.origin||s&&L.pathname&&!L.pathname.toLowerCase().startsWith(s.toLowerCase())))return[w,L]}function d(m){const w=u(m);if(!w)return;const[$,k]=w,A=n.parsePath(k.pathname+k.search+k.hash),P=$.getAttribute("state");m.preventDefault(),i(A,{resolve:!1,replace:$.hasAttribute("replace"),scroll:!$.hasAttribute("noscroll"),state:P&&JSON.parse(P)})}function b(m){const w=u(m);if(!w)return;const[$,k]=w;a[k.pathname]||n.preloadRoute(k,$.getAttribute("preload")!=="false")}function S(m){const w=u(m);if(!w)return;const[$,k]=w;a[k.pathname]||(a[k.pathname]=setTimeout(()=>{n.preloadRoute(k,$.getAttribute("preload")!=="false"),delete a[k.pathname]},200))}function g(m){const w=u(m);if(!w)return;const[,$]=w;a[$.pathname]&&(clearTimeout(a[$.pathname]),delete a[$.pathname])}function f(m){let w=m.submitter&&m.submitter.hasAttribute("formaction")?m.submitter.getAttribute("formaction"):m.target.getAttribute("action");if(!w)return;if(!w.startsWith("https://action/")){const k=new URL(w,Ur);if(w=n.parsePath(k.pathname+k.search),!w.startsWith(t))return}if(m.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const $=kn.get(w);if($){m.preventDefault();const k=new FormData(m.target);m.submitter&&m.submitter.name&&k.append(m.submitter.name,m.submitter.value),$.call({r:n,f:m.target},k)}}kt(["click","submit"]),document.addEventListener("click",d),e&&(document.addEventListener("mouseover",S),document.addEventListener("mouseout",g),document.addEventListener("focusin",b),document.addEventListener("touchstart",b)),document.addEventListener("submit",f),_(()=>{document.removeEventListener("click",d),e&&(document.removeEventListener("mouseover",S),document.removeEventListener("mouseout",g),document.removeEventListener("focusin",b),document.removeEventListener("touchstart",b)),document.removeEventListener("submit",f)})}}function Rn(e){if(M)return Sn(e);const r=()=>({value:window.location.pathname+window.location.search+window.location.hash,state:window.history.state}),t=Br();return yn({get:r,set({value:n,replace:s,scroll:i,state:a}){s?window.history.replaceState(zr(a),"",n):window.history.pushState(a,"",n),xn(window.location.hash.slice(1),i),Kr()},init:n=>wn(window,"popstate",Wr(n,s=>{if(s&&s<0)return!t.confirm(s);{const i=r();return!t.confirm(i.value,{state:i.state})}})),create:Cn(e.preload,e.explicitLinks,e.actionBase),utils:{go:n=>window.history.go(n),beforeLeave:t}})(e)}function Pn(e){e.forEach(r=>{if(!r.attrs.href)return;let t=document.head.querySelector(`link[href="${r.attrs.href}"]`);t||(t=document.createElement("link"),t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",r.attrs.href),document.head.appendChild(t))})}var En=" ";const Tn={style:e=>Q("style",e.attrs,()=>l(e.children),!0),link:e=>Q("link",e.attrs,void 0,!0),script:e=>e.attrs.src?Q("script",N(()=>e.attrs,{get id(){return e.key}}),()=>h(En),!0):null};function xe(e){let{tag:r,attrs:{key:t,...n}={key:void 0},children:s}=e;return Tn[r]({attrs:n,key:t,children:s})}function In(e,r,t,n="default"){return _t(async()=>{{const i=(await e.import())[n],c=(await r.inputs?.[e.src].assets()).filter(d=>d.tag==="style"||d.attrs.rel==="stylesheet");return typeof window<"u"&&Pn(c),{default:d=>[...c.map(b=>xe(b)),Dt(i,d)]}}})}const G={NORMAL:0,WILDCARD:1,PLACEHOLDER:2};function An(e={}){const r={options:e,rootNode:lt(),staticRoutesMap:{}},t=n=>e.strictTrailingSlash?n:n.replace(/\/$/,"")||"/";if(e.routes)for(const n in e.routes)Fe(r,t(n),e.routes[n]);return{ctx:r,lookup:n=>On(r,t(n)),insert:(n,s)=>Fe(r,t(n),s),remove:n=>Ln(r,t(n))}}function On(e,r){const t=e.staticRoutesMap[r];if(t)return t.data;const n=r.split("/"),s={};let i=!1,a=null,c=e.rootNode,u=null;for(let d=0;d<n.length;d++){const b=n[d];c.wildcardChildNode!==null&&(a=c.wildcardChildNode,u=n.slice(d).join("/"));const S=c.children.get(b);if(S===void 0){if(c&&c.placeholderChildren.length>1){const g=n.length-d;c=c.placeholderChildren.find(f=>f.maxDepth===g)||null}else c=c.placeholderChildren[0]||null;if(!c)break;c.paramName&&(s[c.paramName]=b),i=!0}else c=S}return(c===null||c.data===null)&&a!==null&&(c=a,s[c.paramName||"_"]=u,i=!0),c?i?{...c.data,params:i?s:void 0}:c.data:null}function Fe(e,r,t){let n=!0;const s=r.split("/");let i=e.rootNode,a=0;const c=[i];for(const u of s){let d;if(d=i.children.get(u))i=d;else{const b=_n(u);d=lt({type:b,parent:i}),i.children.set(u,d),b===G.PLACEHOLDER?(d.paramName=u==="*"?`_${a++}`:u.slice(1),i.placeholderChildren.push(d),n=!1):b===G.WILDCARD&&(i.wildcardChildNode=d,d.paramName=u.slice(3)||"_",n=!1),c.push(d),i=d}}for(const[u,d]of c.entries())d.maxDepth=Math.max(c.length-u,d.maxDepth||0);return i.data=t,n===!0&&(e.staticRoutesMap[r]=i),i}function Ln(e,r){let t=!1;const n=r.split("/");let s=e.rootNode;for(const i of n)if(s=s.children.get(i),!s)return t;if(s.data){const i=n.at(-1)||"";s.data=null,Object.keys(s.children).length===0&&s.parent&&(s.parent.children.delete(i),s.parent.wildcardChildNode=null,s.parent.placeholderChildren=[]),t=!0}return t}function lt(e={}){return{type:e.type||G.NORMAL,maxDepth:0,parent:e.parent||null,children:new Map,data:e.data||null,paramName:e.paramName||null,wildcardChildNode:null,placeholderChildren:[]}}function _n(e){return e.startsWith("**")?G.WILDCARD:e[0]===":"||e==="*"?G.PLACEHOLDER:G.NORMAL}const ct=[{$component:{src:"src/routes/[...404].tsx?pick=default&pick=$css",build:()=>import("./_...404_.js"),import:()=>import("./_...404_.js")},path:"/*404",filePath:"/home/ai6/dev/conduit/src/routes/[...404].tsx"},{$GET:{src:"src/routes/clientId.ts?pick=GET",build:()=>import("./clientId.js"),import:()=>import("./clientId.js")},path:"/clientId",filePath:"/home/ai6/dev/conduit/src/routes/clientId.ts"},{$component:{src:"src/routes/debug.tsx?pick=default&pick=$css",build:()=>import("./debug.js"),import:()=>import("./debug.js")},path:"/debug",filePath:"/home/ai6/dev/conduit/src/routes/debug.tsx"},{$component:{src:"src/routes/feed.tsx?pick=default&pick=$css",build:()=>import("./feed.js"),import:()=>import("./feed.js")},path:"/feed",filePath:"/home/ai6/dev/conduit/src/routes/feed.tsx"},{$component:{src:"src/routes/import.tsx?pick=default&pick=$css",build:()=>import("./import.js"),import:()=>import("./import.js")},path:"/import",filePath:"/home/ai6/dev/conduit/src/routes/import.tsx"},{$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("./index.js"),import:()=>import("./index.js")},path:"/",filePath:"/home/ai6/dev/conduit/src/routes/index.tsx"},{$component:{src:"src/routes/playlist.tsx?pick=default&pick=$css",build:()=>import("./playlist.js"),import:()=>import("./playlist.js")},path:"/playlist",filePath:"/home/ai6/dev/conduit/src/routes/playlist.tsx"},{$component:{src:"src/routes/results.tsx?pick=default&pick=$css",build:()=>import("./results.js"),import:()=>import("./results.js")},path:"/results",filePath:"/home/ai6/dev/conduit/src/routes/results.tsx"},{$component:{src:"src/routes/trending.tsx?pick=default&pick=$css",build:()=>import("./trending.js"),import:()=>import("./trending.js")},path:"/trending",filePath:"/home/ai6/dev/conduit/src/routes/trending.tsx"},{$component:{src:"src/routes/watch.tsx?pick=default&pick=$css",build:()=>import("./watch.js"),import:()=>import("./watch.js")},path:"/watch",filePath:"/home/ai6/dev/conduit/src/routes/watch.tsx"},{$component:{src:"src/routes/channel/[id].tsx?pick=default&pick=$css",build:()=>import("./_id_.js"),import:()=>import("./_id_.js")},path:"/channel/:id",filePath:"/home/ai6/dev/conduit/src/routes/channel/[id].tsx"},{$component:{src:"src/routes/library/(library).tsx?pick=default&pick=$css",build:()=>import("./(library).js"),import:()=>import("./(library).js")},path:"/library/(library)",filePath:"/home/ai6/dev/conduit/src/routes/library/(library).tsx"},{$component:{src:"src/routes/library/blocklist.tsx?pick=default&pick=$css",build:()=>import("./blocklist.js"),import:()=>import("./blocklist.js")},path:"/library/blocklist",filePath:"/home/ai6/dev/conduit/src/routes/library/blocklist.tsx"},{$component:{src:"src/routes/library/downloads.tsx?pick=default&pick=$css",build:()=>import("./downloads.js"),import:()=>import("./downloads.js")},path:"/library/downloads",filePath:"/home/ai6/dev/conduit/src/routes/library/downloads.tsx"},{$component:{src:"src/routes/library/history.tsx?pick=default&pick=$css",build:()=>import("./history.js"),import:()=>import("./history.js")},path:"/library/history",filePath:"/home/ai6/dev/conduit/src/routes/library/history.tsx"},{$component:{src:"src/routes/library/playlists.tsx?pick=default&pick=$css",build:()=>import("./playlists.js"),import:()=>import("./playlists.js")},path:"/library/playlists",filePath:"/home/ai6/dev/conduit/src/routes/library/playlists.tsx"},{$component:{src:"src/routes/library/subscriptions.tsx?pick=default&pick=$css",build:()=>import("./subscriptions.js"),import:()=>import("./subscriptions.js")},path:"/library/subscriptions",filePath:"/home/ai6/dev/conduit/src/routes/library/subscriptions.tsx"},{$component:{src:"src/routes/library/watch-later.tsx?pick=default&pick=$css",build:()=>import("./watch-later.js"),import:()=>import("./watch-later.js")},path:"/library/watch-later",filePath:"/home/ai6/dev/conduit/src/routes/library/watch-later.tsx"},{$component:{src:"src/routes/preferences/(preferences).tsx?pick=default&pick=$css",build:()=>import("./(preferences).js"),import:()=>import("./(preferences).js")},path:"/preferences/(preferences)",filePath:"/home/ai6/dev/conduit/src/routes/preferences/(preferences).tsx"}],Dn=Mn(ct.filter(e=>e.$component));function Mn(e){function r(t,n,s,i){const a=Object.values(t).find(c=>s.startsWith(c.id+"/"));return a?(r(a.children||(a.children=[]),n,s.slice(a.id.length)),t):(t.push({...n,id:s,path:s.replace(/\/\([^)/]+\)/g,"").replace(/\([^)/]+\)/g,"")}),t)}return e.sort((t,n)=>t.path.length-n.path.length).reduce((t,n)=>r(t,n,n.path,n.path),[])}function Nn(e,r){const t=qn.lookup(e);if(t){const n=t.route[`$${r}`];return n===void 0?void 0:{handler:n,params:t.params}}}function Fn(e){return e.$GET||e.$POST||e.$PUT||e.$PATCH||e.$DELETE}const qn=An({routes:ct.reduce((e,r)=>{if(!Fn(r))return e;let t=r.path.replace(/\([^)/]+\)/g,"").replace(/\*([^/]*)/g,(n,s)=>`**:${s}`);if(/:[^/]*\?/g.test(t))throw new Error(`Optional parameters are not supported in API routes: ${t}`);if(e[t])throw new Error(`Duplicate API routes for "${t}" found at "${e[t].route.path}" and "${r.path}"`);return e[t]={route:r},e},{})});function ut(){function e(t){return{...t,...t.$$route?t.$$route.require().route:void 0,info:{...t.$$route?t.$$route.require().route.info:{},filesystem:!0},component:In(t.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:t.children?t.children.map(e):void 0}}return Dn.map(e)}let qe;const Hn=M?()=>J().routes:()=>qe||(qe=ut()),jn=ae({}),Un=e=>{const[r,t]=nt({}),[n,s]=x();R(()=>{n()||s(document.querySelector("media-player"))});let i;return R(()=>{n()&&(i=n().subscribe(({paused:a})=>{console.log("playerStateStore.tsx:39",a),t({paused:a})}))}),_(()=>{i?.()}),o(jn.Provider,{value:r,get children(){return e.children}})};function zn(e){const r=Ft();return e=U({children:"â–¼"},e),o(Ee,N({as:"span","aria-hidden":"true"},()=>r.dataset(),e))}function Kn(e){const r=qt();e=U({id:r.generateId("indicator")},e);const[t,n]=q(e,["forceMount"]);return o(I,{get when(){return t.forceMount||r.isChecked()},get children(){return o(Ee,N({as:"div"},()=>r.dataset(),n))}})}const dt=ae();function Bn(){const e=Ce(dt);if(e===void 0)throw new Error("[kobalte]: `useMenuRadioGroupContext` must be used within a `Menu.RadioGroup` component");return e}function Wn(e){const t=Ht().generateId(`radiogroup-${Re()}`);e=U({id:t},e);const[n,s]=q(e,["value","defaultValue","onChange","disabled"]),[i,a]=jt({value:()=>n.value,defaultValue:()=>n.defaultValue,onChange:u=>n.onChange?.(u)}),c={isDisabled:()=>n.disabled,isSelectedValue:u=>u===i(),setSelectedValue:a};return o(dt.Provider,{value:c,get children(){return o(Ut,s)}})}function Vn(e){const r=Bn();e=U({closeOnSelect:!1},e);const[t,n]=q(e,["value","onSelect"]);return o(zt,N({role:"menuitemradio",get checked(){return r.isSelectedValue(t.value)},onSelect:()=>{t.onSelect?.(),r.setSelectedValue(t.value)}},n))}const pt=ae();function ce(){const e=Ce(pt);if(e===void 0)throw new Error("[kobalte]: `usePopoverContext` must be used within a `Popover` component");return e}function Gn(e){let r;const t=ce();e=U({id:t.generateId("content")},e);const[n,s]=q(e,["ref","style","onOpenAutoFocus","onCloseAutoFocus","onPointerDownOutside","onFocusOutside","onInteractOutside"]);let i=!1,a=!1,c=!1;const u=g=>{n.onCloseAutoFocus?.(g),t.isModal()?(g.preventDefault(),i||be(t.triggerRef())):(g.defaultPrevented||(a||be(t.triggerRef()),g.preventDefault()),a=!1,c=!1)},d=g=>{n.onPointerDownOutside?.(g),t.isModal()&&(i=g.detail.isContextMenu)},b=g=>{n.onFocusOutside?.(g),t.isOpen()&&t.isModal()&&g.preventDefault()},S=g=>{n.onInteractOutside?.(g),!t.isModal()&&(g.defaultPrevented||(a=!0,g.detail.originalEvent.type==="pointerdown"&&(c=!0)),Jt(t.triggerRef(),g.target)&&g.preventDefault(),g.detail.originalEvent.type==="focusin"&&c&&g.preventDefault())};return Kt({isDisabled:()=>!(t.isOpen()&&t.isModal()),targets:()=>[]}),Bt({ownerRef:()=>r,isDisabled:()=>!(t.isOpen()&&(t.isModal()||t.preventScroll()))}),Wt({trapFocus:()=>t.isOpen()&&t.isModal(),onMountAutoFocus:n.onOpenAutoFocus,onUnmountAutoFocus:u},()=>r),R(()=>_(t.registerContentId(s.id))),o(I,{get when(){return t.contentPresence.isPresent()},get children(){return o(Vt,{get children(){return o(Gt,N({role:"dialog",tabIndex:-1,get disableOutsidePointerEvents(){return t.isOpen()&&t.isModal()},get excludedElements(){return[t.triggerRef]},get style(){return{"--kb-popover-content-transform-origin":"var(--kb-popper-content-transform-origin)",position:"relative",...n.style}},get"aria-labelledby"(){return t.titleId()},get"aria-describedby"(){return t.descriptionId()},onPointerDownOutside:d,onFocusOutside:b,onInteractOutside:S,get onDismiss(){return t.close}},()=>t.dataset(),s))}})}})}function Jn(e){const r=ce();e=U({id:r.generateId("description")},e);const[t,n]=q(e,["id"]);return R(()=>_(r.registerDescriptionId(t.id))),o(Ee,N({as:"p",get id(){return t.id}},()=>r.dataset(),n))}function Yn(e){const r=ce();return o(I,{get when(){return r.contentPresence.isPresent()},get children(){return o(oe,e)}})}function Qn(e){const r=`popover-${Re()}`;e=U({id:r,modal:!1,preventScroll:!1},e);const[t,n]=q(e,["id","open","defaultOpen","onOpenChange","modal","preventScroll","forceMount","anchorRef"]),[s,i]=x(),[a,c]=x(),[u,d]=x(),[b,S]=x(),[g,f]=x(),[m,w]=x(),$=Yt({open:()=>t.open,defaultOpen:()=>t.defaultOpen,onOpenChange:O=>t.onOpenChange?.(O)}),k=()=>t.anchorRef?.()??s()??a(),A=Qt(()=>t.forceMount||$.isOpen()),L={dataset:X(()=>({"data-expanded":$.isOpen()?"":void 0,"data-closed":$.isOpen()?void 0:""})),isOpen:$.isOpen,isModal:()=>t.modal??!1,preventScroll:()=>t.preventScroll??!1,contentPresence:A,triggerRef:a,contentId:b,titleId:g,descriptionId:m,setDefaultAnchorRef:i,setTriggerRef:c,setContentRef:d,close:$.close,toggle:$.toggle,generateId:tt(()=>t.id),registerContentId:he(S),registerTitleId:he(f),registerDescriptionId:he(w)};return o(pt.Provider,{value:L,get children(){return o(Xt,N({anchorRef:k,contentRef:u},n))}})}function Xn(e){const r=ce(),[t,n]=q(e,["ref","onClick","onPointerDown"]);return o(Zt,N({"aria-haspopup":"dialog",get"aria-expanded"(){return r.isOpen()},get"aria-controls"(){return r.isOpen()?r.contentId():void 0},onPointerDown:a=>{_e(a,t.onPointerDown),a.preventDefault()},onClick:a=>{_e(a,t.onClick),r.toggle()}},()=>r.dataset(),n))}function Zn(e){let r;const t=er(),[n,s]=q(e,["ref","onFocusIn","onFocusOut","onPointerMove","onPointerLeave"]);return R(Ze([()=>r,()=>t.hotkey()],([i,a])=>{if(M||!i)return;const c=tr(i),u=d=>{a.every(S=>d[S]||d.code===S)&&be(i)};c.addEventListener("keydown",u),_(()=>c.removeEventListener("keydown",u))})),R(()=>{if(!t.pauseOnPageIdle())return;const i=rr(r);i.addEventListener("blur",t.pauseAllTimer),i.addEventListener("focus",t.resumeAllTimer),_(()=>{i.removeEventListener("blur",t.pauseAllTimer),i.removeEventListener("focus",t.resumeAllTimer)})}),Q("ol",N({tabIndex:-1},s),()=>l(o(B,{get each(){return t.toasts()},children:i=>i.toastComponent({get toastId(){return i.id}})})),!0)}function es(e){const r=`toast-region-${Re()}`;e=U({id:r,hotkey:["altKey","KeyT"],duration:5e3,limit:3,swipeDirection:"right",swipeThreshold:50,pauseOnInteraction:!0,pauseOnPageIdle:!0,topLayer:!0},e);const[t,n]=q(e,["style","hotkey","duration","limit","swipeDirection","swipeThreshold","pauseOnInteraction","pauseOnPageIdle","topLayer","aria-label","regionId"]),s=X(()=>nr.toasts().filter(f=>f.region===t.regionId).slice(0,t.limit)),[i,a]=x(!1),c=sr(()=>or),u=()=>s().length>0,d=()=>t.hotkey.join("+").replace(/Key/g,"").replace(/Digit/g,""),b=()=>(t["aria-label"]||c().format("notifications",{hotkey:d()})).replace(ir,d()),S=()=>({[lr]:t.topLayer?"":void 0}),g={isPaused:i,toasts:s,hotkey:()=>t.hotkey,duration:()=>t.duration,swipeDirection:()=>t.swipeDirection,swipeThreshold:()=>t.swipeThreshold,pauseOnInteraction:()=>t.pauseOnInteraction,pauseOnPageIdle:()=>t.pauseOnPageIdle,pauseAllTimer:()=>a(!0),resumeAllTimer:()=>a(!1),generateId:tt(()=>n.id)};return o(ar.Provider,{value:g,get children(){return Q("div",N({role:"region",tabIndex:-1,get"aria-label"(){return b()},get style(){return{"pointer-events":u()?t.topLayer?"auto":void 0:"none",...t.style}}},S,n),void 0,!0)}})}async function ts(e,r){const t=await fetch(e),n=rs(await t.text(),r),s=new Blob([n],{type:"text/plain"});return{srtUrl:URL.createObjectURL(s),srtText:n}}function rs(e,r){const t=e.match(/ttp:frameRate="(\d+)"/),n=e.match(/ttp:frameRateMultiplier="(\d+) (\d+)"/),s=t?parseInt(t[1],10):0,i=n?parseInt(n[1],10):1,a=n?parseInt(n[2],10):1;let c=s*i/a;c=r??c,Number.isInteger(c)||(c=parseFloat(c.toFixed(3)));const u=e.match(/ttp:frameRate="ttp:subFrameRate="(\d+)"/),d=u?parseInt(u[1],10):1,b=e.match(/ttp:tickRate="(\d+)"/),S=b?parseInt(b[1],10):1,g=c>0?c:`UNKNOWN
[WARN] TIMING MAY BE INCORRECT`;console.info(`[INFO] FRAMERATE IS ${g}`);let f="",m=0,w="",$="";const k=new RegExp("<p (.*?)>(.*?)</p>","g");let A;for(;(A=k.exec(e))!==null;){const[P,L,O]=A,H=L.trim().match(/[^\s]*="?[^"]*/g).map(F=>F.split("=")).reduce((F,[ue,de])=>(F[ue]=(de||"").replace(/^"/,""),F),{});if(!H.begin||!H.end){console.warn("[WARN] Some string was not parsed, start/end time attribute was missing!");continue}const p=He(H.begin,c,d,S),E=He(H.end,c,d,S),D=O.replace(/<\/br>/g,"").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/<span>(.*?)<\/span>/g,"$1").replace(/(<br.*?>)+/g,`\r
`).replace(/<[^>]*\/>/g,"").replace(/<(\S*?) (.*?)>(.*?)<\/.*?>/g,ns);D.trim()!==""&&($=`${p} --> ${E}`,w!==$?(w=$,m++,f!==""&&(f+=`\r
\r
`),f+=`${m}\r
${$}\r
`):f+=`\r
`,f+=D)}return f+=`\r
\r
`,`\uFEFF${f}`}function He(e,r,t,n){let s=e.match(/(\d*:\d*:\d*)(.*)$/);if(!s){s=e.match(/([0-9.]*)(.*)/);const a={h:3600,m:60,s:1,ms:.001,f:1/r,t:1/n};let c=parseFloat(s[1])*a[s[2]||""],u=Math.floor(c/3600).toString().padStart(2,"0"),d=Math.floor(c%3600/60).toString().padStart(2,"0"),b=Math.floor(c%60).toString().padStart(2,"0"),S=Math.round((c-Math.floor(c))*1e3).toString().padEnd(3,"0").slice(0,3);return`${u}:${d}:${b},${S}`}let i=s[2]||"";if(i.length===0)return`${s[1]},000`;if(i[0]==="."){let a=i.slice(1).padEnd(3,"0").slice(0,3);return`${s[1]},${a}`}if(i[0]===":"){let a=i.slice(1).split("."),c=parseInt(a[0]);a.length>1&&(c+=parseInt(a[1])/t);let u=Math.floor(c*1e3/r).toString().padEnd(3,"0").slice(0,3);return`${s[1]},${u}`}return`${s[1]},000`}function ns(e,r,t,n){if(r!=="span")return n;const s=t.replace(/\s*=\s*/g,"=").split(" ").filter(a=>a.trim()),i={};for(const a of s){let c;if(c=a.match(/tts:color="(.*?)"/)){i.color=c[1];continue}switch(a){case'tts:fontStyle="italic"':i.fontStyle="italic";break;case'tts:textDecoration="underline"':i.textDecoration="underline";break;case'tts:fontWeight="bold"':i.fontWeight="bold";break}}return i.color&&(n=`<font color="${i.color}">${n.trim()}</font>`),i.fontStyle&&(n=`<i>${n.trim()}</i>`),i.textDecoration&&(n=`<u>${n.trim()}</u>`),i.fontWeight&&(n=`<b>${n.trim()}</b>`),n}const ss="_controls_1xob6_1",os={controls:ss};var as=["<media-tooltip","><media-tooltip-trigger>",'</media-tooltip-trigger><media-tooltip-content class="','"',">","</media-tooltip-content></media-tooltip>"];function is(e){const r=()=>e.placement.includes("bottom");return h(as,v()+C("class",l(e.class,!0),!1),l(e.triggerSlot),`tooltip animate-out fade-out slide-out-to-bottom-2 data-[visible]:animate-in data-[visible]:fade-in data-[visible]:slide-in-from-bottom-4 z-10 rounded-sm bg-black/90 px-2 py-0.5 text-sm font-medium text-white ${r()?"!top-12":""}`,C("placement",l(e.placement,!0),!1),l(e.contentSlot))}var ls=["<media-play-button",' class="ring-primary relative inline-flex h-10 w-10 cursor-pointer items-center justify-center rounded-md outline-none ring-inset hover:bg-white/20 data-[focus]:ring-4"><media-icon class="media-paused:block hidden h-8 w-8" type="play"></media-icon><media-icon class="media-paused:hidden h-8 w-8" type="pause"></media-icon></media-play-button>'],cs=["<span",' class="media-paused:block hidden">Play</span>'],us=["<span",' class="media-paused:hidden">Pause</span>'];function ds(e){return o(is,{get placement(){return e.tooltipPlacement},get triggerSlot(){return h(ls,v())},get contentSlot(){return[h(cs,v()),h(us,v())]}})}const ps="_captions_jw0nu_1",fs={captions:ps};var ms=["<media-captions",' class="','"></media-captions>'];function hs(){return h(ms,v(),`${l(fs.captions,!0)} media-preview:opacity-0 media-controls:bottom-[85px] media-captions:opacity-100 absolute inset-0 bottom-2 z-10 select-none break-words opacity-0 transition-[opacity,bottom] duration-300`)}var gs=["<media-gesture",' class="absolute inset-0 z-0 block h-full w-full" event="dblpointerup" action="toggle:paused"></media-gesture>'],vs=["<media-gesture",' class="absolute inset-0 z-0 block h-full w-full" event="pointerup" action="toggle:controls"></media-gesture>'],bs=["<media-gesture",' class="absolute left-0 top-0 z-10 block h-full w-1/5" event="dblpointerup" action="seek:-10"></media-gesture>'],ys=["<media-gesture",' class="absolute right-0 top-0 z-10 block h-full w-1/5" event="dblpointerup" action="seek:10"></media-gesture>'];function ws(){return[h(gs,v()),h(vs,v()),h(bs,v()),h(ys,v())]}var xs=["<media-slider-chapters",' class="relative flex h-full w-full items-center rounded-[1px]"><template>',"</template></media-slider-chapters>"],$s=["<div",' class="last-child:mr-0 relative mr-0.5 flex h-full w-full items-center rounded-[1px]" style="','"><div class="ring-primary relative z-0 h-[5px] w-full rounded-sm bg-white/30 group-data-[focus]:ring-[3px]"><div class="bg-primary z-10 absolute h-full w-[var(--chapter-fill)] rounded-sm will-change-[width]"></div><div class="absolute z-0 h-full w-[var(--chapter-progress)] rounded-sm bg-white/50 will-change-[width]"></div></div></div>'];function Ss(){return h(xs,v(),l(o(ks,{})))}function ks(){return h($s,v(),"contain:layout style")}var Cs=["<media-slider-thumbnail",' class="block h-[var(--thumbnail-height)] max-h-[160px] min-h-[80px] w-[var(--thumbnail-width)] min-w-[120px] max-w-[180px] overflow-hidden border border-white bg-black"',"></media-slider-thumbnail>"],Rs=["<media-slider-preview",' class="flex flex-col pointer-events-none items-center opacity-0 transition-opacity duration-200 data-[visible]:opacity-100"',"><!--$-->","<!--/--><!--$-->","<!--/--></media-slider-preview>"];function Ps(e){return h(Rs,v(),C("noclamp",l(e?.noClamp,!0),!1),l(o(I,{get when(){return e?.thumbnails},get children(){return h(Cs,v(),C("src",l(e?.thumbnails,!0),!1))}})),l(e?.children))}var Es=["<div",' class="absolute left-[var(--slider-fill)] top-1/2 z-20 h-[15px] w-[15px] -translate-x-1/2 -translate-y-1/2 rounded-full border border-[#cacaca] bg-white opacity-0 ring-white/40 transition-opacity group-data-[active]:opacity-100 group-data-[dragging]:ring-4 will-change-[left]"></div>'];function Ts(){return h(Es,v())}var Is=["<div",' class="mt-2 text-sm" data-part="chapter-title"></div>'],As=["<media-slider-value",' class="text-[13px]" type="pointer" format="time"></media-slider-value>'],Os=["<media-time-slider",' class="group relative mx-[7.5px] inline-flex h-1 mb-2 py-2 w-full cursor-pointer touch-none select-none items-center outline-none"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></media-time-slider>"];function Ls(e){return h(Os,v(),l(o(Ss,{})),l(o(Ts,{})),l(o(Ps,{get thumbnails(){return e.thumbnails},get children(){return[h(Is,v()),h(As,v())]}})))}var _s=["<div",' class="','"><!--$-->',"<!--/--><!--$-->",'<!--/--><media-controls class="','"><div class="flex-1"></div><media-controls-group class="flex w-full items-center px-2">','</media-controls-group><media-controls-group class="-mt-0.5 flex w-full items-center px-2 pb-2">',"</media-controls-group></media-controls></div>"];function Ds(e){return h(_s,v(),Ct(e.classList),l(o(ws,{})),l(o(hs,{})),`${l(os.controls,!0)} font-sans media-controls:opacity-100 invisible media-controls:visible  absolute inset-0 z-10 flex h-full w-full flex-col bg-gradient-to-t from-black/10 to-transparent opacity-0 transition-opacity`,l(o(Ls,{get thumbnails(){return e.thumbnails}})),l(o(ds,{tooltipPlacement:"top start"})))}var Ms=["<div",' class="','"><div class="flex items-center justify-between h-4">',"</div></div>"];function Ns(){const[e,r]=Z(),t=Ie(),[n,s]=x(void 0),[i]=Ae();return ie(),R(()=>{console.log(i.v,"searchParams.v"),i.v&&s(i.v)}),h(Ms,v(),e.player.dismissed||!e.player.small?"hidden":"",l(o(V,{appearance:"subtle",class:"hover:bg-white/20 rounded-md p-0 h-10 w-10 flex items-center justify-center",get icon(){return o(ot,{class:"text-white w-8 h-8 min-w-max"})},onClick:()=>{n()&&t(`/watch?v=${n()}`)}})))}var Fs=["<div",' class="absolute z-50 top-0 right-0 w-full h-full opacity-100 pointer-events-auto bg-black/50"><div class="flex flex-col items-center justify-center w-full h-full gap-3"><div class="text-2xl font-bold text-white"><!--$-->',"<!--/--> <!--$-->",'<!--/--></div><div class="flex flex-col"><div class="text-lg text-white">','</div><div class="text-lg text-white">Please try switching to a different instance or refresh the page.</div></div><div class="flex justify-center gap-2"><button class="px-4 py-2 text-lg text-white border border-white rounded-md">Close</button></div></div></div>'],qs=["<div",' class="absolute z-50 top-0 right-0 w-full h-full pointer-events-auto"><div class="flex flex-col items-center justify-center w-full h-full gap-3"><div class="text-2xl font-bold text-white">Playing next in <!--$-->','<!--/--> seconds</div><div class="flex flex-col"><div class="text-lg scale-75 sm:scale-100 text-white w-96 h-full my-2">','</div></div><div class="flex justify-center gap-2"><!--$-->',"<!--/--><!--$-->","<!--/--></div></div></div>"],Hs=["<media-player",' keep-alive id="player" class="','"'," key-disabled","",' autoplay src="https://files.vidstack.io/sprite-fight/720p.mp4" crossorigin playsinline><media-provider class="max-h-screen max-w-screen [&amp;>video]:max-h-screen [&amp;>video]:max-w-screen [&amp;>video]:h-full [&amp;>video]:w-full"><media-poster aria-hidden="true" class="absolute inset-0 block h-full w-full rounded-md opacity-0 transition-opacity data-[visible]:opacity-100 [&amp;>img]:h-full [&amp;>img]:w-full [&amp;>img]:object-cover"></media-poster><!--$-->',"<!--/--></media-provider><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></media-player>"],js=["<track",">"];function Us(e){const r=at();let t;Te();const[n,s]=ie(),[i,a]=x(void 0);R(()=>{r.query.v&&a(r.query.v)});const[c]=cr(),u=ur();x(void 0);const[d,b]=x([]),[S,g]=nt({}),[f,m]=x(0);r.query.t;const[w,$]=x(!1),[k,A]=x();R(()=>{console.log(P(),O()),c()?Array.isArray(c().videos)?A(c().videos):A(c().relatedStreams):(A(u.list()),console.log(u,"queue 2 list"))}),R(()=>{});const[P,L]=x(null),[O,H]=x(null);R(()=>{});const[p,E]=Ae(),D=()=>{if(console.log("playing next",P()),!P())return;const y=new URL(window.location.origin+P().url);p.fullscreen&&y.searchParams.set("fullscreen",p.fullscreen),xt(y.pathname+y.search.toString()),L(null)},[F,ue]=x(!1),de=5,[vt,sa]=x(de);let bt;function ee(){console.log("dismiss"),clearInterval(bt),ue(!1)}_(()=>{ee()});const[z,oa]=x([]),[pe,yt]=x({show:!1,dismissed:!1});R(()=>{});const W=()=>{};Pe(()=>{document.addEventListener("visibilitychange",W),document.addEventListener("pagehide",W),document.addEventListener("keydown",Oe),window.addEventListener("beforeunload",W),window.addEventListener("unload",W),document.addEventListener("media-enter-fullscreen-request",y=>{y.preventDefault(),y.stopPropagation(),console.log("Full screen request intercepted. Element will not go full screen.")},{capture:!0}),_(()=>{document.removeEventListener("keydown",Oe),document.removeEventListener("visibilitychange",W),document.removeEventListener("pagehide",W),document.removeEventListener("media-enter-fullscreen-request",y=>{y.preventDefault(),y.stopPropagation()})})}),R(()=>{w()});const wt=Vr(),xt=Ie();R(()=>{wt()});const Oe=y=>{if(document.activeElement?.tagName!=="INPUT")switch(y.key){case"f":console.log(`f key pressed, fullscreen: ${document.fullscreenElement}`),document.fullscreenElement?(document.exitFullscreen(),screen.orientation.unlock(),E({fullscreen:void 0},{replace:!0})):(document.documentElement.requestFullscreen(),screen.orientation.lock("landscape").catch(()=>{}),E({fullscreen:!0},{replace:!0}),document.body.scroll({top:0,left:0,behavior:"smooth"})),y.preventDefault();break;case"m":t.muted=!t.muted,y.preventDefault();break;case"j":t.currentTime=Math.max(t.currentTime-10,0),y.preventDefault();break;case"c":const K=t.textTracks.toArray().find(j=>j.id.startsWith("track-")&&(j.language==="en"||j.language==="en_US"||j.language==="en_GB"));if(K){console.log(K.id);const j=d().find(re=>re.id===K.id)?.metadata.url;console.log(j,"track url"),j&&ts(j,null).then(({srtUrl:re})=>{console.log(K.src,re,"track src"),g(K.id,{src:re}),console.log(S,"captions store track"),K.mode=K.mode==="showing"?"hidden":"showing"})}y.preventDefault();break;case"k":t.paused||t.pause(),y.preventDefault();break;case" ":if(y.preventDefault(),console.log(document.activeElement?.tagName),document.activeElement?.tagName==="BUTTON"){document.activeElement.click();return}if(document.activeElement?.tagName.startsWith("MEDIA-"))return;t.paused||t.pause();break;case"ArrowUp":y.shiftKey&&(t.volume=Math.min(t.volume+.05,1),y.preventDefault());break;case"ArrowDown":y.shiftKey&&(t.volume=Math.max(t.volume-.05,0),y.preventDefault());break;case"ArrowLeft":if(y.altKey)return;y.shiftKey?$t():t.currentTime=Math.max(t.currentTime-5,0),y.preventDefault();break;case"ArrowRight":if(y.altKey)return;y.shiftKey?St():t.currentTime=t.currentTime+5,y.preventDefault();break;case"0":t.currentTime=0,y.preventDefault();break;case"N":y.shiftKey&&(D(),y.preventDefault());break;case"Escape":F()&&P()?(ee(),y.preventDefault()):pe().show&&(yt({show:!1,dismissed:!0}),y.preventDefault());break;case",":t.currentTime-=.04;break;case".":t.currentTime+=.04;break;case"R":y.shiftKey&&(e.onReload?.(),y.preventDefault());break}};x([]),R(()=>{});const $t=()=>{},St=()=>{},[te,fe]=Z();return R(()=>{r.pathname!=="/watch"?fe("player","small",!0):(fe("player","small",!1),te.player.dismissed&&fe("player","dismissed",!1))}),h(Hs,v(),` z-[99999] aspect-video bg-black text-white font-sans overflow-hidden ring-primary data-[focus]:ring-4 ${p.fullscreen&&!te.player.small?"!absolute inset-0 w-screen h-screen":""} ${p.fullscreen?"":"!sticky sm:!relative !top-0"} ${te.player.small?"!sticky sm:!sticky !top-10 !left-1 !w-56 sm:!w-72 lg:!w-96 ":""} ${te.player.dismissed?"!hidden":""}`,C("current-time",l(f(),!0),!1),C("tabindex",-1,!1)+C("playbackrate",l(n.speed,!0),!1),C("muted",n.muted,!0)+C("volume",l(n.volume,!0),!1),l(o(B,{get each(){return Object.values(S)},children:y=>h(js,v()+C("id",l(y.id,!0),!1)+C("kind",l(y.kind,!0),!1)+C("src",l(S[y.id].src,!0),!1)+C("srclang",l(y.srcLang,!0),!1)+C("label",l(y.label,!0),!1)+C("data-type",l(y.dataType,!0),!1))})),l(o(I,{get when(){return z().length>0&&pe().show&&!pe().dismissed},get children(){return h(Fs,v(),l(z()[z().length-1]?.name),l(z()[z().length-1]?.details),l(z()[z().length-1]?.message))}})),l(o(I,{get when(){return F()&&P()},get children(){return h(qs,v(),l(vt()),l(o(dr,{layout:"sm:grid",get v(){return P()?.info??void 0}})),l(o(V,{onClick:()=>{ee(),D()},label:"Play now (Shift + N)"})),l(o(V,{appearance:"subtle",class:"bg-bg1",onClick:()=>{ee()},label:"Dismiss (Esc)"})))}})),l(o(Ds,{})),l(o(Ns,{})))}var zs=["<nav",' class="flex gap-2 px-2 py-2 justify-evenly">',"</nav>"],Ks=["<div",' class="w-6 h-6">',"</div>"],Bs=["<span",' class="mt-1 text-xs font-semibold ">',"</span>"];function Ws(e){return h(zs,v(),l(o(B,{get each(){return e.items},children:r=>o(ye,{activeClass:"text-primary",inactiveClass:"text-text2",get href(){return r.href},class:"flex flex-col items-center justify-center text-sm ",get children(){return[h(Ks,v(),l(r.icon)),h(Bs,v(),l(r.label))]}})})))}function Vs(e){return le({a:{baseProfile:"tiny",version:"1.2",viewBox:"0 0 24 24"},c:'<path d="M12 3s-6.186 5.34-9.643 8.232A1.041 1.041 0 0 0 2 12a1 1 0 0 0 1 1h2v7a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-4h4v4a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-7h2a1 1 0 0 0 1-1 .98.98 0 0 0-.383-.768C18.184 8.34 12 3 12 3z"/>'},e)}function Gs(e){return le({a:{baseProfile:"tiny",version:"1.2",viewBox:"0 0 24 24"},c:'<path d="M17.414 6.586a2 2 0 0 0-2.828 0L12 9.172 9.414 6.586a2 2 0 1 0-2.828 2.828L9.171 12l-2.585 2.586a2 2 0 1 0 2.828 2.828L12 14.828l2.586 2.586c.39.391.902.586 1.414.586s1.024-.195 1.414-.586a2 2 0 0 0 0-2.828L14.829 12l2.585-2.586a2 2 0 0 0 0-2.828z"/>'},e)}function Js(e){return le({a:{viewBox:"0 0 1024 1024"},c:'<path d="M834.1 469.2A347.49 347.49 0 0 0 751.2 354l-29.1-26.7a8.09 8.09 0 0 0-13 3.3l-13 37.3c-8.1 23.4-23 47.3-44.1 70.8-1.4 1.5-3 1.9-4.1 2-1.1.1-2.8-.1-4.3-1.5-1.4-1.2-2.1-3-2-4.8 3.7-60.2-14.3-128.1-53.7-202C555.3 171 510 123.1 453.4 89.7l-41.3-24.3c-5.4-3.2-12.3 1-12 7.3l2.2 48c1.5 32.8-2.3 61.8-11.3 85.9-11 29.5-26.8 56.9-47 81.5a295.64 295.64 0 0 1-47.5 46.1 352.6 352.6 0 0 0-100.3 121.5A347.75 347.75 0 0 0 160 610c0 47.2 9.3 92.9 27.7 136a349.4 349.4 0 0 0 75.5 110.9c32.4 32 70 57.2 111.9 74.7C418.5 949.8 464.5 959 512 959s93.5-9.2 136.9-27.3A348.6 348.6 0 0 0 760.8 857c32.4-32 57.8-69.4 75.5-110.9a344.2 344.2 0 0 0 27.7-136c0-48.8-10-96.2-29.9-140.9zM713 808.5c-53.7 53.2-125 82.4-201 82.4s-147.3-29.2-201-82.4c-53.5-53.1-83-123.5-83-198.4 0-43.5 9.8-85.2 29.1-124 18.8-37.9 46.8-71.8 80.8-97.9a349.6 349.6 0 0 0 58.6-56.8c25-30.5 44.6-64.5 58.2-101a240 240 0 0 0 12.1-46.5c24.1 22.2 44.3 49 61.2 80.4 33.4 62.6 48.8 118.3 45.8 165.7a74.01 74.01 0 0 0 24.4 59.8 73.36 73.36 0 0 0 53.4 18.8c19.7-1 37.8-9.7 51-24.4 13.3-14.9 24.8-30.1 34.4-45.6 14 17.9 25.7 37.4 35 58.4 15.9 35.8 24 73.9 24 113.1 0 74.9-29.5 145.4-83 198.4z"/>'},e)}function Ys(e){return le({a:{viewBox:"0 0 1024 1024"},c:'<path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"/>'},e)}function Qs(e={}){return Object.keys(e).reduce((r,t)=>t==="days"||e[t]===!1?r:e[t]===!0?`${r}; ${t}`:`${r}; ${t}=${e[t]}`,"")}const Xs=(e,r,t)=>{if(M)return;const n={days:7,path:"/",...t},s=new Date(Date.now()+n.days*864e5).toUTCString();document.cookie=e+"="+encodeURIComponent(r)+"; expires="+s+Qs(n)},Zs=(e,r="")=>!M&&document.cookie.split("; ").reduce((t,n)=>{const s=n.split("=");return s[0]===e?decodeURIComponent(s[1]):t},"")||r;function eo(e,r){const[t,n]=x(()=>Zs(e,r));return[t,(i,a={})=>{n(i),Xs(e,i,a)}]}const je=e=>o(pr,{get open(){return e.isOpen},get onOpenChange(){return e.onOpenChange},get children(){return[o(fr,{class:"p-1 outline-none focus-visible:ring-2 focus-visible:ring-primary rounded-md",get children(){return o(zn,{get children(){return e.triggerIcon}})}}),o(mr,{get children(){return o(hr,{class:`bg-bg1 border border-bg3/80 rounded-md z-[999999]
          -top-2
          animate-in
          fade-in
          slide-in-from-top-10
          duration-200
          `,get children(){return[o(rt,{}),o(Wn,{class:`max-h-[40vh] overflow-y-auto
            p-2
            `,get value(){return e.selectedValue},get onChange(){return e.onChange},get children(){return o(B,{get each(){return e.options},children:r=>o(Vn,{get value(){return r.value??r.label},class:"cursor-pointer w-full border-bg3 flex relative items-center px-7 py-2 rounded border-b last:border-none hover:bg-bg3 focus-visible:bg-bg3 focus-visible:ring-4 focus-visible:ring-primary focus-visible:outline-none",get onClick(){return r.onClick},get children(){return[o(Kn,{class:"inline-flex absolute left-0",get children(){return o(Er,{fill:"currentColor",class:"h-4 w-4 mx-1 text-text1"})}}),r.label]}})})}})]}})}})]}});var to=["<button",' class="sm:hidden bg-bg2 p-1 px-2 text-gray-500 flex items-center justify-center hover:bg-bg1 hover:text-text1 focus-visible:ring-2 focus-visible:ring-primary/80 rounded focus-visible:outline-none " aria-label="Back">',"</button>"],ro=["<ul",' class="','" aria-multiselectable="false" aria-live="polite" aria-label="Suggestions" id="search-suggestion-list">',"</ul>"],no=["<div",' class="','"><!--$-->','<!--/--><label for="search-input" class="sr-only">Search</label><input aria-haspopup="listbox" aria-owns="suggestion-list"',' aria-controls="suggestion-list" id="search-input" class="w-full border-0 max-w-full peer outline-none bg-bg1 border-bg2 focus:border-2 focus:border-r-0 placeholder-shown:focus:border-r-2 text-text1 text-sm rounded-lg rounded-r-none placeholder-shown:rounded-r-lg transition-transform focus:ring-primary focus:border-primary py-1 px-2.5" type="combobox"',' placeholder="Search... (Ctrl + K)" aria-autocomplete="list"','><div class="relative peer-placeholder-shown:hidden flex w-max items-center justify-center gap-1 peer h-[29px] peer-focus:h-[33px] bg-bg1 py-1 px-1 -left-1 border-0 peer-focus:border-2 peer-focus:border-primary peer-focus:border-l-0 rounded-r-lg"><button id="search-button" class="text-gray-500 flex items-center justify-center hover:bg-bg1 hover:text-text1 focus-visible:ring-2 focus-visible:ring-primary/80 rounded focus-visible:outline-none " aria-label="Search">','</button><button id="search-clear-button" class="right-2 top-1/2 transform text-gray-500 flex items-center justify-center hover:bg-bg1 hover:text-text1 focus-visible:ring-2 focus-visible:ring-primary/80 rounded focus-visible:outline-none " aria-label="Clear search">',"</button></div><!--$-->","<!--/--></div>"],so=["<button",' id="','" role="none" class="text-xs text-gray-500 h-8 w-8 flex items-center justify-center hover:bg-bg1 hover:text-text1 focus-visible:ring-2 focus-visible:ring-primary/80 rounded focus-visible:outline-none " aria-label="','">',"</button>"],oo=["<li",' class="','" id="','"',' tabindex="0"','><span aria-hidden="true">','</span><div class="ml-2 flex items-center"><button id="','" role="none" class="text-xs text-gray-500 h-8 w-8 flex items-center justify-center hover:bg-bg1 hover:text-text1 focus-visible:ring-2 focus-visible:ring-primary/80 rounded focus-visible:outline-none " aria-label="','">',"</button><!--$-->","<!--/--></div></li>"];const ao=()=>{const[e,r]=x(""),[t,n]=x([]),[s,i]=x(-1),[a]=Ae();R(()=>{d(a.search_query||Xe(()=>u()))});const[c]=ie();st(()=>({queryKey:["suggestions"],queryFn:async()=>(console.log("fetching suggestions",e()),await fetch(c.instance?.api_url+"/suggestions?query="+e()).then(f=>f.json())),enabled:!!(e().length>1&&c.instance?.api_url&&b()),select:f=>{console.log(f),f&&!f.error?n(f.map(m=>({value:m,isHistory:!1}))):n([])}})),Ie(),Z();const[u,d]=x(""),[b,S]=x(!1);Pe(()=>{document.addEventListener("keydown",g),_(()=>{document.removeEventListener("keydown",g)})});function g(f){f.ctrlKey&&f.key==="k"&&f.preventDefault(),f.key}return h(no,v(),`relative z-[999999] flex items-center transition-all duration-500  ${t().length>0&&b()?"-left-10 sm:left-0 w-screen sm:w-auto":""}`,l(o(I,{get when(){return t().length>0&&b()},get children(){return h(to,v(),l(o(Or,{"aria-hidden":"true",class:"w-6 h-6"})))}})),C("aria-expanded",t().length>0&&l(b(),!0),!1),C("value",l(u(),!0),!1),C("aria-activedescendant",s()>-1?`option-${l(s(),!0)}`:l(void 0,!0),!1),l(o(Lr,{class:"w-5 h-5","aria-hidden":"true"})),l(o(De,{class:"w-5 h-5","aria-hidden":"true"})),l(o(I,{get when(){return t().length>0&&b()},get children(){return o(oe,{get children(){return h(ro,v(),"fixed w-screen h-screen sm:h-auto left-0 right-0 sm:w-max sm:min-w-[30rem] sm:left-[calc(70vw-18rem)] top-10 sm:mt-1 bg-bg1 border-1 border-bg2/80 p-2 z-[999999] text-text1 rounded-md border border-bg1 shadow-md transform transition-transform duration-250 ease-in origin-center animate-in fade-in aria-[expanded]:animate-out aria-[expanded]:fade-out ",l(o(B,{get each(){return t()},children:(f,m)=>h(oo,v(),`text-sm leading-none text-text1 border-b border-bg2 last:border-none rounded-md flex items-center justify-between h-8 px-2 py-5 relative select-none outline-none cursor-pointer hover:bg-bg2 ${s()===m()?"bg-bg2 focus-visible:ring-2 ring-primary":""}`,`search-option-${l(m(),!0)}`,C("aria-selected",l(s(),!0)===l(m(),!0),!1),C("aria-label",l(f.value,!0),!1),l(f.value),`search-suggestion-use-${l(m(),!0)}`,`Use suggestion ${l(f.value,!0)} (Enter)`,l(o(ot,{class:"w-5 h-5","aria-hidden":"true"})),l(o(I,{get when(){return f.isHistory},get children(){return h(so,v(),`search-suggestion-remove-${l(m(),!0)}`,`Remove suggestion ${l(f.value,!0)} (Ctrl+Delete)`,l(o(De,{class:"w-5 h-5","aria-hidden":"true"})))}})))})))}})}})))};var io=["<img",' src="/logo.svg" alt="Conduit" class="h-8 w-8 aspect-square min-w-max ">'],lo=["<div",' class="flex items-start flex-col gap-2 text-text1"><details class="text-xs"><summary class="link">Users: <!--$-->',"<!--/--></summary><!--$-->","<!--/--></details><div>Syncing: <!--$-->","<!--/--></div><div>IndexedDB: <!--$-->","<!--/--></div><div>WebRTC: <!--$-->","<!--/--></div><div>OPFS: <!--$-->","<!--/--></div></div>"],co=["<div",' class="w-full h-full bg-bg1"><div class="p-4 flex flex-col items-center justify-center gap-2"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></div></div>"],uo=["<nav",' class="fixed top-0 left-0 bg-bg2 w-full z-[99999] h-10 px-2 flex items-center justify-between"><button class="sr-only focus:not-sr-only absolute top-0 left-0">Skip navigation</button><div class="flex items-center justify-between w-full max-w-full min-w-0"><!--$-->','<!--/--><ul class="hidden md:inline">',"</ul><!--$-->",'<!--/--><div class="flex items-center gap-2 "><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></div></div><!--$-->","<!--/--></nav>"],po=["<div",' class="flex items-center gap-2">ID: <!--$-->',"<!--/-->Name: <!--$-->","<!--/--> <!--$-->","<!--/--></div>"];function fo(){const[e,r]=Ce(ft),[,t]=eo("theme","monokai");Te();const n=[{href:"/feed",label:"Feed"},{href:"/trending",label:"Trending"},{href:"/library",label:"Library"},{href:"/import",label:"Import"}],s=st(()=>({queryKey:["instances"],queryFn:async()=>{const p=await fetch("https://piped-instances.kavin.rocks/");if(!p.ok)throw new Error("Failed to fetch instances");return await p.json()},initialData:gr("instances",[],"json","localStorage"),select:p=>(vr("instances",p,"localStorage"),p),retry:p=>p<3})),[i,a]=ie(),c=["Alice","Bob","Charlie","Dave","Eve","Frank","Grace","Heidi","Ivan","Judy","Kevin","Larry","Mallory","Nancy","Oscar","Peggy","Quentin","Rupert","Sybil","Trent","Ursula","Victor","Walter","Xavier","Yvonne","Zelda"],[u]=Z(),[d,b]=x(!1),[S,g]=x(c[Math.floor(Math.random()*c.length)]),[f,m]=x(""),[w,$]=x("");R(()=>{const p=JSON.parse(localStorage.getItem("room")||"{}");p.name&&g(p.name),m(p.id||""),$(p.password||"")});const[k,A]=x(!1),[P,L]=x(!1);function O(p,E){return p==="connected"&&E==="connected"?"online":p==="connected"&&E!=="connected"?"offline":p!=="connected"&&E==="connected"?"volatile":"disconnected"}const H=()=>{if(!s.data)return;const p=s.data;let E=p.findIndex(F=>F.api_url===i.instance.api_url);E=E>-1?E:0;const D=(E+1)%p.length;a("instance",p[D]),yr.show(`You are now connected to ${p[D].name}`)};return Pe(()=>{M||document.addEventListener("keydown",p=>{p.key==="I"&&p.shiftKey&&!p.ctrlKey&&!p.altKey&&(H(),p.preventDefault())})}),_(()=>{M||document.removeEventListener("keydown",p=>{p.key==="I"&&p.shiftKey&&!p.ctrlKey&&!p.altKey&&(H(),p.preventDefault())})}),h(uo,v(),l(o(ye,{href:"/",class:"text-text1 mx-2 w-8 h-8",get children(){return h(io,v())}})),l(o(B,{each:n,children:p=>o(ye,{get href(){return p.href},class:"text-sm p-1 text-left transition ",get children(){return p.label}})})),l(o(ao,{})),l(o(Qn,{get children(){return[o(Xn,{class:"p-1 outline-none focus-visible:ring-2 focus-visible:ring-primary rounded-md",get children(){return o(Mt,{get children(){return[o(Y,{get when(){return u.sync.syncing},get children(){return o(Tr,{class:"w-6 h-6 text-yellow-500"})}}),o(Y,{get when(){return O(u.sync.providers.opfs,u.sync.providers.webrtc)==="online"},get children(){return o(_r,{class:"w-7 h-7 text-green-500"})}}),o(Y,{get when(){return O(u.sync.providers.opfs,u.sync.providers.webrtc)==="disconnected"},get children(){return o(Gs,{class:"w-9 h-9 text-red-500"})}}),o(Y,{get when(){return O(u.sync.providers.opfs,u.sync.providers.webrtc)==="offline"},get children(){return o(Dr,{class:"w-7 h-7 text-text1"})}}),o(Y,{get when(){return O(u.sync.providers.opfs,u.sync.providers.webrtc)==="volatile"},get children(){return o(Mr,{class:"w-6 h-6 text-text1"})}})]}})}}),o(Yn,{get children(){return o(Gn,{class:`bg-bg1 border border-bg3/80 p-2 rounded-md
                animate-in
                fade-in
                slide-in-from-top-10
                duration-200
                z-[99999]
                `,get children(){return[o(rt,{}),o(Jn,{get class(){return`text-sm p-1 text-left flex flex-col gap-2 items-center ${f()?"text-green-600":"text-red-600"}`},get children(){return[o(I,{get when(){return f()},get children(){return["Connected: ",f(),h(lo,v(),l(u.sync.users.length),l(o(B,{get each(){return u.sync.users},children:p=>h(po,v(),l(p.id),l(p.name),p.name===S()&&"(You)")})),u.sync.syncing?"true":"false",l(u.sync.providers.idb),l(u.sync.providers.webrtc),l(u.sync.providers.opfs)),o(V,{label:"Leave",onClick:()=>{localStorage.removeItem("room"),location.reload()}})]}}),o(I,{get when(){return!f()},get children(){return["Disconnected",o(V,{label:"Join room",onClick:()=>b(!0)})]}})]}})]}})}})]}})),l(o(je,{get isOpen(){return k()},onOpenChange:A,onChange:p=>{r(p),t(p)},options:[{value:"monokai",label:"Monokai"},{value:"dracula",label:"Dracula"},{value:"discord",label:"Discord"},{value:"github",label:"Github"}],get selectedValue(){return e()},get triggerIcon(){return o(Ir,{fill:"currentColor",class:"h-5 w-5 text-text1"})}})),l(o(je,{get isOpen(){return P()},onOpenChange:L,get selectedValue(){return i.instance.api_url},onChange:p=>{let E=s.data.find(D=>D.api_url===p);E&&a("instance",E)},get options(){return s.data.map(p=>({label:`${p.name} - ${p.uptime_24h.toFixed(0)}%`,value:p.api_url}))},get triggerIcon(){return o(Ar,{fill:"currentColor",class:"h-5 w-5 text-text1"})}})),l(o(br,{get isOpen(){return d()},title:"Join Room",setIsOpen:b,get children(){return h(co,v(),l(o(ge,{name:"name",get value(){return S()},onInput:p=>g(p),placeholder:"Name",type:"text",class:"w-full"})),l(o(ge,{name:"room",type:"text",placeholder:"Room ID",get value(){return f()},onInput:p=>m(p)})),l(o(ge,{name:"password",type:"password",placeholder:"Password",get value(){return w()},onInput:p=>$(p)})),l(o(V,{onClick:()=>{localStorage.setItem("room",JSON.stringify({name:S(),id:f(),password:w()})),location.reload()},label:"Join"})))}})))}var mo=["<div",' class="fixed h-1 w-full -mx-2 top-0 z-[9999999]"><div class="','"></div></div>'],ho=["<div",' class="','"><!--$-->','<!--/--><div aria-hidden="true" class="h-10"></div><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><main><!--$-->","<!--/--><!--$-->",'<!--/--></main><div class="fixed bottom-0 left-0 w-full md:hidden pb-2 sm:pb-5 bg-bg2 z-50">','</div><div class="h-20 md:h-0"></div><!--$-->',"<!--/--></div>"],go=["<div",">Loading...</div>"],vo=["<div",' role="alert" aria-live="assertive" aria-atomic="true" class="sr-only">Current page: <!--$-->',"<!--/--> </div>"];const bo=()=>import("./assets/ReloadPrompt-B1ByR_aX.js"),[$e,Se]=x(""),ft=ae([$e,Se]);function yo(){const e=J();Nt(()=>{function s(c){return c.split(";").map(u=>u.split("=")).reduce((u,d)=>(u[decodeURIComponent(d[0].trim())]=decodeURIComponent(d[1].trim()),u),{})}const a=s(Pr?e?.request.headers.get("cookie")??"":document.cookie).theme??"monokai";Se(a)});const[r]=Z(),t=new Cr({defaultOptions:{queries:{refetchOnMount:!0,refetchOnReconnect:!0,refetchOnWindowFocus:!1,retry:s=>s<3,suspense:!0}}}),n=Te();return R(()=>{console.log(n.store,"sync store")}),o(Rn,{root:s=>o(Le,{get children(){return o(Gr,{tags:[],get children(){return o(Rr,{client:t,get children(){return o(ft.Provider,{value:[$e,Se],get children(){return o(wr,{get children(){return o(kr,{get children(){return o(xr,{get children(){return o($r,{get children(){return o(Un,{get children(){return o(Sr,{get children(){return h(ho,v(),`${l($e(),!0)} bg-bg1 font-manrope text-sm scrollbar text-text1 selection:bg-accent2 selection:text-text3 overflow-x-hidden`,l(o(fo,{})),l(o(Us,{})),l(o(I,{get when(){return r.loading},get children(){return h(mo,v(),"h-1 bg-gradient-to-r from-accent1 via-primary to-accent1 bg-repeat-x w-full animate-stripe")}})),l(o(oe,{get children(){return o(es,{get children(){return o(Zn,{class:"fixed bottom-0 right-0 p-4 flex flex-col gap-2 z-[999999] w-[400px] max-w-[100vw] outline-none"})}})}})),l(s.children),l(o(et,{get children(){return o(Le,{get fallback(){return h(go,v())},get children(){return o(bo,{})}})}})),l(o(Ws,{get items(){return[{href:"/feed",label:"Feed",icon:o(Vs,{fill:"currentColor",class:"w-6 h-6 "})},{href:"/trending",label:"Trending",icon:o(Js,{fill:"currentColor",class:"w-6 h-6 "})},{href:"/library",label:"Library",icon:o(Ys,{fill:"currentColor",class:"w-6 h-6 "})}]}})),l(o(wo,{})))}})}})}})}})}})}})}})}})}})}}),get children(){return o(Hn,{})}})}const wo=()=>{const e=at();return o(oe,{get children(){return h(vo,v(),l(e.pathname))}})},xo=M?e=>{const r=J();return r.response.status=e.code,r.response.statusText=e.text,_(()=>!r.nativeEvent.handled&&(r.response.status=200)),null}:e=>null;var $o=["<span",' style="font-size:1.5em;text-align:center;position:fixed;left:0px;bottom:55%;width:100%;">',"</span>"];const So=e=>{const r=M?"500 | Internal Server Error":"Error | Uncaught Client Exception";return o(et,{get fallback(){return[h($o,v(),l(r)),o(xo,{code:500})]},get children(){return e.children}})};var Ue=["<script",">","<\/script>"],ko=["<script",' type="module"'," async","><\/script>"],Co=["<script",' type="module" async',"><\/script>"];const Ro=h("<!DOCTYPE html>");function mt(e,r,t=[]){for(let n=0;n<r.length;n++){const s=r[n];if(s.path!==e[0].path)continue;let i=[...t,s];if(s.children){const a=e.slice(1);if(a.length===0||(i=mt(a,s.children,i),!i))continue}return i}}function Po(e){const r=J(),t=r.nonce;let n=[];return Promise.resolve().then(async()=>{if(r.router&&r.router.matches){const s=[...r.router.matches];for(;s.length&&(!s[0].info||!s[0].info.filesystem);)s.shift();const i=s.length&&mt(s,r.routes);if(i)for(let a=0;a<i.length;a++){const c=i[a],d=await globalThis.MANIFEST.client.inputs[c.$component.src].assets();n.push.apply(n,d)}else console.warn("No route matched for preloading js assets")}n=[...new Map(n.map(s=>[s.attrs.key,s])).values()].filter(s=>s.attrs.rel==="modulepreload"&&!r.assets.find(i=>i.attrs.key===s.attrs.key))}),Rt(()=>n.length?n.map(s=>xe(s)):void 0),o(Qe,{get children(){return[Ro,o(e.document,{get assets(){return[o(Pt,{}),r.assets.map(s=>xe(s))]},get scripts(){return t?[h(Ue,v()+C("nonce",l(t,!0),!1),`window.manifest = ${JSON.stringify(r.manifest)}`),h(ko,v(),C("nonce",l(t,!0),!1),C("src",l(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]:[h(Ue,v(),`window.manifest = ${JSON.stringify(r.manifest)}`),h(Co,v(),C("src",l(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]},get children(){return o(Et,{get children(){return o(So,{get children(){return o(yo,{})}})}})}})]}})}function Eo(e={}){let r,t=!1;const n=a=>{if(r&&r!==a)throw new Error("Context conflict")};let s;if(e.asyncContext){const a=e.AsyncLocalStorage||globalThis.AsyncLocalStorage;a?s=new a:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const i=()=>{if(s&&r===void 0){const a=s.getStore();if(a!==void 0)return a}return r};return{use:()=>{const a=i();if(a===void 0)throw new Error("Context is not available");return a},tryUse:()=>i(),set:(a,c)=>{c||n(a),r=a,t=!0},unset:()=>{r=void 0,t=!1},call:(a,c)=>{n(a),r=a;try{return s?s.run(a,c):c()}finally{t||(r=void 0)}},async callAsync(a,c){r=a;const u=()=>{r=a},d=()=>r===a?u:void 0;Be.add(d);try{const b=s?s.run(a,c):c();return t||(r=void 0),await b}finally{Be.delete(d)}}}}function To(e={}){const r={};return{get(t,n={}){return r[t]||(r[t]=Eo({...e,...n})),r[t],r[t]}}}const se=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},ze="__unctx__",Io=se[ze]||(se[ze]=To()),Ao=(e,r={})=>Io.get(e,r),Ke="__unctx_async_handlers__",Be=se[Ke]||(se[Ke]=new Set);function Oo(e){let r;const t=gt(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(t,{...n,body:e.node.req.body}):new Request(t,{...n,get body(){return r||(r=zo(e),r)}})}function Lo(e){return e.web??={request:Oo(e),url:gt(e)},e.web.request}function _o(){return Vo()}const ht=Symbol("$HTTPEvent");function Do(e){return typeof e=="object"&&(e instanceof we||e?.[ht]instanceof we||e?.__is_event__===!0)}function T(e){return function(...r){let t=r[0];if(Do(t))r[0]=t instanceof we||t.__is_event__?t:t[ht];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(t=_o(),!t)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");r.unshift(t)}return e(...r)}}const gt=T(sn),Mo=T(Zr),ke=T(Yr),We=T(en),No=T(tn),ne=T(on),Ve=T(an),Fo=T(ln),qo=T(cn),Ge=T(Qr),Ho=T(rn),jo=T(nn),Uo=T(Xr),zo=T(dn),Ko=T(un),Bo=T(Lo);function Wo(){return Ao("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:fn})}function Vo(){return Wo().use().event}const ve=Symbol("fetchEvent");function Go(e){return{request:Bo(e),response:Qo(e),clientAddress:Mo(e),locals:{},nativeEvent:e}}function Jo(e){if(!e[ve]){const r=Go(e);e[ve]=r}return e[ve]}class Yo{event;constructor(r){this.event=r}get(r){const t=Ve(this.event,r);return Array.isArray(t)?t.join(", "):t||null}has(r){return this.get(r)!==void 0}set(r,t){return Fo(this.event,r,t)}delete(r){return Ko(this.event,r)}append(r,t){qo(this.event,r,t)}getSetCookie(){const r=Ve(this.event,"Set-Cookie");return Array.isArray(r)?r:[r]}forEach(r){return Object.entries(ne(this.event)).forEach(([t,n])=>r(Array.isArray(n)?n.join(", "):n,t,this))}entries(){return Object.entries(ne(this.event)).map(([r,t])=>[r,Array.isArray(t)?t.join(", "):t])[Symbol.iterator]()}keys(){return Object.keys(ne(this.event))[Symbol.iterator]()}values(){return Object.values(ne(this.event)).map(r=>Array.isArray(r)?r.join(", "):r)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function Qo(e){return{get status(){return We(e)},set status(r){ke(e,r)},get statusText(){return No(e)},set statusText(r){ke(e,We(),r)},headers:new Yo(e)}}function Xo(e){const r=Ho(e.nativeEvent,"flash");if(!r)return;let t=JSON.parse(r);if(!t||!t.result)return;const n=[...t.input.slice(0,-1),new Map(t.input[t.input.length-1])];return jo(e.nativeEvent,"flash","",{maxAge:0}),{input:n,url:t.url,pending:!1,result:t.error?new Error(t.result):t.result}}async function Zo(e){const r=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,e.response.headers.set("Content-Type","text/html"),Object.assign(e,{manifest:await r.json(),assets:[...await r.inputs[r.handler].assets()],router:{submission:Xo(e)},routes:ut(),$islands:new Set})}function ea(e,r,t={}){return pn({handler:n=>{const s=Jo(n);return Jr(s,async()=>{const i=Nn(new URL(s.request.url).pathname,s.request.method);if(i){const f=(await i.handler.import())[s.request.method];s.params=i.params||{},me.context={event:s};const m=await f(s);if(m!==void 0)return m;if(s.request.method!=="GET")throw new Error(`API handler for ${s.request.method} "${s.request.url}" did not return a response.`)}const a=await r(s);typeof t=="function"&&(t=await t(a));const c=t.mode||"stream";if(t.nonce&&(a.nonce=t.nonce),c==="sync"){const g=Tt(()=>(me.context.event=a,e(a)),t);return a.response&&a.response.headers.get("Location")?Ge(n,a.response.headers.get("Location")):g}let u={...t};if(u.onCompleteAll){const g=u.onCompleteAll;u.onCompleteAll=f=>{Ye(a)(f),g(f)}}else u.onCompleteAll=Ye(a);if(u.onCompleteShell){const g=u.onCompleteShell;u.onCompleteShell=f=>{Je(a,n)(),g(f)}}else u.onCompleteShell=Je(a,n);const d=It(()=>(me.context.event=a,e(a)),u);if(a.response&&a.response.headers.get("Location"))return Ge(n,a.response.headers.get("Location"));if(c==="async")return d;const{writable:b,readable:S}=new TransformStream;return d.pipeTo(b),S})}})}function Je(e,r){return()=>{e.response&&e.response.headers.get("Location")&&(ke(r,302),Uo(r,"Location",e.response.headers.get("Location")))}}function Ye(e){return({write:r})=>{const t=e.response&&e.response.headers.get("Location");t&&r(`<script>window.location="${t}"<\/script>`)}}function ta(e,r){return ea(e,Zo,r)}var ra=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],na=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const Pa=ta(()=>o(Po,{document:({assets:e,children:r,scripts:t})=>h(na,v(),o(Qe,{get children(){return h(ra,l(e))}}),l(r),l(t))}));export{Pa as default};
//# sourceMappingURL=ssr.js.map
