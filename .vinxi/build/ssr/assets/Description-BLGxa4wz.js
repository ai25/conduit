import{createComponent as a,ssr as r,ssrHydrationKey as l,escape as t,ssrAttribute as _}from"solid-js/web";import g from"numeral";import{createSignal as v,createEffect as C,Show as w,For as L,Switch as R,Match as A}from"solid-js";import{A as F,Q as T,V as I,E as M,C as b,ao as B,aA as $,aq as j,R as O}from"./syncStore-DaflpWzS.js";import{h as E,i as N,j as q,k as Q,l as Z,m as J,n as K,o as H,a as G}from"./index-BPtxG8PX.js";import{createQuery as W}from"@tanstack/solid-query";import{createDate as X,createTimeAgo as Y}from"@solid-primitives/date";import{u as ee,L as U}from"./Link-ClDVT-6o.js";import{f as te,g as ae}from"./index-Bhsy5eyg.js";import{f as se}from"./routing-CB9zsxEG.js";var re=["<div",' class="flex flex-col gap-2 items-center justify-center overflow-auto w-full">',"</div>"],le=["<div",' class="flex flex-col gap-2 items-center justify-center w-[90vw] max-w-3xl"><!--$-->',"<!--/--><!--$-->","<!--/--></div>"],ne=["<div",' class="flex gap-2 justify-between mb-2 w-full even:bg-bg2 p-2"><div class="flex flex-col gap-2 items-start justify-center text-sm"><div><span class="text-text2">Quality: </span> <!--$-->','<!--/--></div><div> <span class="text-text2">Codec: </span><!--$-->','<!--/--></div><div><span class="text-text2">Bitrate: </span><!--$-->','<!--/--> kbps</div><div> <span class="text-text2">FPS: </span><!--$-->','<!--/--></div><div> <span class="text-text2">Size: </span><!--$-->','<!--/--> MB</div></div><button class="btn btn-primary">Download</button></div>'];function ie(s){const[i,d]=v(null),[c,o]=v(),[e,f]=v(null),[k]=F();return C(async()=>{if(!s.isOpen)return;const n=await(await fetch(`${k.instance.api_url}/streams/${s.id}`)).json();if(d(n),o({title:n.title,thumbnail:n.thumbnailUrl,duration:n.duration,type:"stream",url:`/watch?v=${s.id}`,uploaderName:n.uploader,uploaderUrl:n.uploaderUrl,uploaderAvatar:n.uploaderAvatar,uploaderVerified:n.uploaderVerified,views:n.views,uploaded:new Date(n.uploadDate).getTime()}),!Array.isArray(n.videoStreams))throw new Error("No video streams");f(n.videoStreams.map(m=>({quality:m.quality,codec:m.codec,bitrate:m.bitrate,fps:m.fps,contentLength:m.contentLength})))}),a(T,{title:"Download",get isOpen(){return s.isOpen},get setIsOpen(){return s.setIsOpen},get children(){return r(le,l(),t(a(w,{get when(){return c()},get children(){return a(I,{get v(){return c()}})}})),t(a(w,{get when(){return e()&&e().length>0},get children(){return r(re,l(),t(a(L,{get each(){return e()},children:u=>r(ne,l(),t(u.quality),t(u.codec),t((u.bitrate/1e3).toFixed(2)),t(u.fps),t((u.contentLength/1e6).toFixed(2)))})))}})))}})}const de=s=>{const i=M(),[d,c]=ee(),o=()=>!!i.store.subscriptions[s.id];return a(b,{appearance:"primary",get class(){return s.class},onClick:()=>{o()?i.setStore("subscriptions",s.id,void 0):i.setStore("subscriptions",s.id,{subscribedAt:Date.now(),name:s.name})},get isSelected(){return o()},get label(){return`Subscribe${o()?"d":""}`},get isLoading(){return d.sync.providers.opfs==="connecting"},get isDisabled(){return d.sync.providers.opfs!=="connected"&&d.sync.providers.webrtc!=="connected"}})},oe=de;var ce=["<div",' class="max-w-screen-sm max-h-[80vh] overflow-auto">',"</div>"],ue=["<h1",' class="text-lg leading-tight font-bold sm:text-xl ">',"</h1>"],pe=["<img",' width="42" height="42"',' class="rounded-full">'],ge=["<div",' class="my-1 flex justify-between items-center gap-4 sm:justify-start "><div class="flex max-w-max items-center gap-2 text-sm sm:text-base"><!--$-->','<!--/--><div class="flex flex-col items-start justify-start"><!--$-->','<!--/--><div title="','" class="flex w-full items-center text-start text-xs text-text2 sm:text-sm"><!--$-->',"<!--/--> subscribers</div></div></div><!--$-->","<!--/--></div>"],fe=["<div",' title="','" class="flex flex-col @sm:flex-row items-start @sm:items-center justify-between gap-1 my-1 text-sm "><div class="flex items-center gap-1 @sm:max-w-[16rem] @md:max-w-full"><p class="truncate">','</p>•<p class="truncate"><!--$-->','<!--/--> views</p></div><div class="flex flex-col w-full @sm:w-36 "><div class="flex items-center justify-between"><span title="','" class="flex items-center gap-1 "><!--$-->',"<!--/--><!--$-->",'<!--/--></span><span title="','" class="flex items-center gap-1"><!--$-->',"<!--/--><!--$-->",'<!--/--></span></div><div class="w-full h-1 bg-primary rounded mt-2 flex justify-end"><div class="h-full bg-bg3 rounded-r" style="','"></div></div></div></div>'],me=["<div",' class="mt-1 flex flex-col rounded-lg bg-bg2 p-2"><div tabindex="0" id="description"',' class="','">','</div><div class="','"><div class="absolute bottom-full w-full h-5 bg-gradient-to-t from-bg2 to-transparent pointer-events-none"></div></div><button aria-controls="description" class="text-center text-sm text-accent1 hover:underline ">Show <!--$-->',"<!--/--></button></div>"],ve=["<div",' class="bg-bg1 p-4 @container"><div class="flex flex-col gap-2"><div class="flex flex-col gap-2 "><div class="flex items-start justify-between h-full">',"</div><!--$-->","<!--/--></div><!--$-->","<!--/--><!--$-->","<!--/--></div><!--$-->","<!--/--></div>"],he=["<div",' class="w-full h-96 bg-bg1 animate-pulse"></div>'],we=["<div",' class="w-full h-6 bg-bg2 rounded animate-pulse"></div>'],be=["<div",' class="w-full h-12 flex sm:justify-start justify-between gap-2"><div class="w-44 flex items-center gap-2"><div class="w-12 h-12 aspect-square bg-bg2 animate-pulse rounded-full"></div><div class="flex flex-col justify-between py-1 gap-1 h-full w-full "><div class="w-full h-4 bg-bg2 animate-pulse rounded"></div><div class="w-3/4 h-4 bg-bg2 animate-pulse rounded"></div></div></div><div class="w-32 h-10 bg-bg2 animate-pulse rounded-full"></div></div>'],xe=["<div",' class="w-full h-8 flex flex-wrap gap-2 mb-2 items-end justify-between "><div class="w-64 h-4 bg-bg2 animate-pulse rounded-lg"></div><div class="w-full @sm:w-36 h-4 bg-bg2 animate-pulse rounded-lg"></div></div>'],$e=["<div",' class="mt-1 rounded-lg w-full h-24 bg-bg2 animate-pulse"></div>'],Se=["<svg",' class="h-4 w-4 " xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1.25 17.292l-4.5-4.364 1.857-1.858 2.643 2.506 5.643-5.784 1.857 1.857-7.5 7.643z"></path></svg>'],ye=["<div",' class="','">',"</div>"],ke=["<div",' class="flex gap-2 justify-between"><span class="cursor-pointer">',"</span><span>","</span><!--$-->","<!--/--><span>","</span></div>"],Ce=["<pre",">","</pre>"],De=["<pre",' class="flex gap-2"><span class="font-bold"><!--$-->',"<!--/-->:</span> <!--$-->","<!--/--></pre>"],_e=["<span",">","</span>"],Ae=["<div",' class="flex items-center justify-evenly rounded-full p-2 bg-bg2"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></div>"],je=["<div",' class="flex items-center bg-bg2 justify-evenly rounded-full p-2 "><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div></div>'];function Oe(s,i,d){const c=document.querySelector("media-player");c.currentTime=parseInt(i,10);const o=new URL(`/watch?v=${s}`,window.location.origin),e=new URLSearchParams(d);e.set("t",i),o.search=e.toString(),history.pushState({},"",o.toString())}globalThis.handleTimestamp=Oe;async function Ue(s){const d=(await import("dompurify")).default().sanitize;return d(s).replaceAll(/(?:http(?:s)?:\/\/)?(?:www\.)?youtube\.com(\/[/a-zA-Z0-9_?=&-]*)/gm,"$1").replaceAll(/(?:http(?:s)?:\/\/)?(?:www\.)?youtu\.be\/(?:watch\?v=)?([/a-zA-Z0-9_?=&-]*)/gm,"/watch?v=$1").replaceAll(`
`,"<br>").replace(/<a href="\/watch\?v=([a-zA-Z0-9_?=&-]*)&amp;([^"]*)">([a-zA-Z0-9_?=&-:]*)<\/a>/gm,(o,e,f,k)=>{const u=new URL(`https://youtube.com/watch?v=${e}`),n=new URLSearchParams(f),m=new URLSearchParams(window.location.search),D=n.get("t")||"0",S=new URLSearchParams;return n.forEach((p,x)=>{S.set(x,p)}),m.forEach((p,x)=>{S.set(x,p)}),S.forEach((p,x)=>{u.searchParams.set(x,p)}),`<button class="link" onclick="handleTimestamp('${e}','${D}', '${u.search}')">${k}</button>`}).replaceAll(/<a href/gm,'<a class="link" href')}const Fe=s=>{const[i]=F(),[d]=se(),[c,o]=v(void 0);C(()=>{d.v&&o(d.v)});const e=W(()=>({queryKey:["streams",c(),i.instance.api_url],queryFn:()=>B.fetchVideo(c(),i.instance.api_url),enabled:!!(c()&&i.instance.api_url),refetchOnReconnect:!1,refetchOnMount:!1,cacheTime:1/0,staleTime:100*60*1e3,deferStream:!0})),[f,k]=v(!1),[u,n]=v(!1);async function m(h){try{await(await navigator.storage.getDirectory()).removeEntry(h,{recursive:!0})}catch(y){console.error(`Failed to delete ${h}`,y)}}const[D,S]=v(!1),[p,x]=X(e.data?.uploadDate??new Date);C(()=>{x(e.data?.uploadDate??new Date)}),Y(p,{interval:1e3*60});const[V,z]=v(void 0);return C(async()=>{e.data&&z(await Ue(e.data.description))}),[a(T,{get isOpen(){return D()},setIsOpen:S,title:"Debug info",get children(){return[a($,{contentSlot:"Copy to clipboard",get triggerSlot(){return a(b,{as:"div",appearance:"subtle",get icon(){return a(E,{class:"w-4 h-4"})}})},onClick:()=>{navigator.clipboard.writeText(JSON.stringify(e.data,null,2))}}),a(w,{get when(){return e.data},get fallback(){return r(he,l())},get children(){return r(ce,l(),t(a(P,{get data(){return e.data},folded:!1})))}})]}}),a(ie,{get id(){return j(e.data)},get isOpen(){return u()},setIsOpen:n}),r(ve,l(),t(a(w,{get when(){return e.data},get fallback(){return r(we,l())},get children(){return r(ue,l(),t(e.data.title))}})),t(a(w,{get when(){return e.data},get fallback(){return r(be,l())},get children(){return r(ge,l(),t(a(U,{class:"link",get href(){return`${e.data.uploaderUrl}`},get children(){return r(pe,l()+_("src",t(e.data.uploaderAvatar,!0),!1),_("alt",t(e.data.uploader,!0),!1))}})),t(a(U,{get href(){return`${e.data.uploaderUrl}`},class:"link flex w-fit items-center gap-2",get children(){return[e.data.uploader," ",e.data.uploaderVerified&&a(Te,{})]}})),`${t(e.data.uploaderSubscriberCount,!0)} subscribers`,t(g(e.data.uploaderSubscriberCount).format("0a").toUpperCase()),t(a(oe,{get name(){return e.data.uploader},get id(){return e.data?.uploaderUrl?.split("/channel/")[1]??""}})))}})),t(a(w,{get when(){return e.data},get fallback(){return a(Ve,{})},get children(){return a(Pe,{get downloaded(){return s.downloaded},deleteVideo:()=>m(j(e.data)),setDownloadModalOpen:()=>n(!0),get refetch(){return e.refetch},setDebugInfoOpen:()=>S(!0)})}})),t(a(w,{get when(){return e.data},get fallback(){return r(xe,l())},get children(){return r(fe,l(),`Published ${(()=>{const h=p().toString().split(":")[0];return t(h.slice(0,h.length-3),!0)})()} • ${t(g(e.data.views).format("0,0"),!0)} views`,(()=>{const h=p().toString().split(":")[0],y=p().toString().split(" ")[4];return`${t(h.slice(0,h.length-3))} ${t(y.slice(0,y.length-3))}`})(),e.data.views>1e4?t(g(e.data.views).format("0.00a").toUpperCase()):t(g(e.data.views).format("0,0").toUpperCase()),`${t(g(e.data.likes).format("0,0"),!0)} likes`,t(a(te,{class:"w-5 h-5 text-text2"})),e.data.likes>1e3?t(g(e.data.likes).format("0.0a").toUpperCase()):t(g(e.data.likes).format("0,0").toUpperCase()),`${t(g(e.data.dislikes).format("0,0"),!0)} likes`,t(a(ae,{class:"h-5 w-5 text-text2 ",fill:"currentColor"})),e.data.dislikes>1e3?t(g(e.data.dislikes).format("0.0a").toUpperCase()):t(g(e.data.dislikes).format("0,0").toUpperCase()),`width:${t(e.data.dislikes,!0)/(t(e.data.likes,!0)+t(e.data.dislikes,!0))*100}%`)}})),t(a(w,{get when(){return e.data},get fallback(){return r($e,l())},get children(){return r(me,l(),_("aria-expanded",t(f(),!0),!1),`min-w-0 max-w-full overflow-hidden ${f()?"":"max-h-20"}`,V(),`${f()?"hidden":""} w-full h-0 relative`,f()?"less":"more")}})))]},Te=()=>r(Se,l()),P=s=>{const[i,d]=v(s.folded),c=typeof s.data=="object"&&s.data!==null;return r(ye,l(),`pl-${t(s.level,!0)||1} flex text-xs font-mono`,c?r(ke,l(),i()?t(a(N,{})):t(a(q,{})),Array.isArray(s.data)?"[":"{",i()?"...":r(Ce,l(),t(Object.entries(s.data).map(([o,e],f)=>r(De,l(),t(o),t(a(P,{data:e,get level(){return(s.level||0)+1},folded:!0})))))),Array.isArray(s.data)?"]":"}"):r(_e,l(),t(s.data)))},Ze=Fe,Pe=s=>r(Ae,l(),t(a(R,{get children(){return[a(A,{get when(){return s.downloaded},get children(){return a($,{as:"div",contentSlot:"Delete",get triggerSlot(){return a(b,{get icon(){return a(Q,{class:"h-6 w-6"})},appearance:"subtle",get onClick(){return s.deleteVideo}})}})}}),a(A,{get when(){return!s.downloaded},get children(){return a($,{as:"div",contentSlot:"Download",get triggerSlot(){return a(b,{get icon(){return a(Z,{class:"h-6 w-6"})},appearance:"subtle",get onClick(){return s.setDownloadModalOpen}})}})}})]}})),t(a($,{as:"div",contentSlot:"Share",get triggerSlot(){return a(b,{get icon(){return a(J,{class:"h-6 w-6"})},appearance:"subtle",onClick:()=>{O.show("Not implemented")}})}})),t(a($,{as:"div",contentSlot:"Save",get triggerSlot(){return a(b,{get icon(){return a(K,{class:"h-6 w-6"})},appearance:"subtle",onClick:()=>{O.show("Not implemented")}})}})),t(a($,{as:"div",contentSlot:"Debug info",get triggerSlot(){return a(b,{get icon(){return a(H,{class:"h-6 w-6"})},appearance:"subtle",get onClick(){return s.setDebugInfoOpen}})}})),t(a($,{as:"div",contentSlot:"Soft Refresh (Shift+R)",get triggerSlot(){return a(b,{get icon(){return a(G,{class:"h-6 w-6"})},appearance:"subtle",get onClick(){return s.refetch}})}}))),Ve=()=>r(je,l());export{Te as C,Ze as D,oe as S,Ue as s};
//# sourceMappingURL=Description-BLGxa4wz.js.map
