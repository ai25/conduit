import{I as Ce,a4 as Le,Q as ke,L as Ee,O as Q,_ as Me,aE as Re,aF as Ve,aG as G,at as xe,ae as j,R as we}from"./syncStore-BssUQgBy.js";import{l as De,j as M,A as oe,e as t,r as s,K as i,w as l,S as q,a as E,G as ze,x as ve,y as o,H as Ie,L as re,M as H,W as Ae,O as Ne,T as Se,Q as Be}from"./routing-BmD2xUmi.js";import{h as Qe,i as qe,j as Ze,k as He,l as Ge,m as Je,n as Ke,o as We,a as Xe}from"./index-BnPmuIsI.js";import{c as Ye}from"./index-B3L84c1c.js";import{u as et,L as ye}from"./Link-Dg-h0Eyu.js";import{f as tt,g as lt}from"./index-Cb4tY8hP.js";const at={fetchVideo:async(a,n)=>{if(!a)throw new Error("videoId is undefined");let d=await fetch(n+"/streams/"+a);if(!d.ok)throw new Error("video not found");return d.json()}};var it=o('<div class="flex flex-col gap-2 items-center justify-center overflow-auto w-full">'),nt=o('<div class="flex flex-col gap-2 items-center justify-center w-[90vw] max-w-3xl"><!$><!/><!$><!/>'),rt=o('<div class="flex gap-2 justify-between mb-2 w-full even:bg-bg2 p-2"><div class="flex flex-col gap-2 items-start justify-center text-sm"><div><span class=text-text2>Quality: </span> <!$><!/></div><div> <span class=text-text2>Codec: </span><!$><!/></div><div><span class=text-text2>Bitrate: </span><!$><!/> kbps</div><div> <span class=text-text2>FPS: </span><!$><!/></div><div> <span class=text-text2>Size: </span><!$><!/> MB</div></div><button class="btn btn-primary">Download');function st(a){const[n,d]=M(null),[v,u]=M(),[e,$]=M(null),[D]=Ce();return oe(async()=>{if(!a.isOpen)return;const r=await(await fetch(`${D.instance.api_url}/streams/${a.id}`)).json();if(d(r),u({title:r.title,thumbnail:r.thumbnailUrl,duration:r.duration,type:"stream",url:`/watch?v=${a.id}`,uploaderName:r.uploader,uploaderUrl:r.uploaderUrl,uploaderAvatar:r.uploaderAvatar,uploaderVerified:r.uploaderVerified,views:r.views,uploaded:new Date(r.uploadDate).getTime()}),!Array.isArray(r.videoStreams))throw new Error("No video streams");$(r.videoStreams.map(f=>({quality:f.quality,codec:f.codec,bitrate:f.bitrate,fps:f.fps,contentLength:f.contentLength})))}),t(ke,{title:"Download",get isOpen(){return a.isOpen},get setIsOpen(){return a.setIsOpen},get children(){var _=s(nt),r=_.firstChild,[f,U]=i(r.nextSibling),m=f.nextSibling,[g,S]=i(m.nextSibling);return l(_,t(q,{get when(){return v()},get children(){return t(Le,{get v(){return v()}})}}),f,U),l(_,t(q,{get when(){return E(()=>!!e())()&&e().length>0},get children(){var R=s(it);return l(R,t(ze,{get each(){return e()},children:A=>(()=>{var b=s(rt),x=b.firstChild,F=x.firstChild,Z=F.firstChild,K=Z.nextSibling,W=K.nextSibling,[X,Y]=i(W.nextSibling),V=F.nextSibling,de=V.firstChild,ce=de.nextSibling,ue=ce.nextSibling,[ge,$e]=i(ue.nextSibling),ee=V.nextSibling,fe=ee.firstChild,p=fe.nextSibling,[w,P]=i(p.nextSibling);w.nextSibling;var y=ee.nextSibling,z=y.firstChild,I=z.nextSibling,N=I.nextSibling,[B,h]=i(N.nextSibling),C=y.nextSibling,k=C.firstChild,T=k.nextSibling,L=T.nextSibling,[J,te]=i(L.nextSibling);J.nextSibling;var le=x.nextSibling;return l(F,()=>A.quality,X,Y),l(V,()=>A.codec,ge,$e),l(ee,()=>(A.bitrate/1e3).toFixed(2),w,P),l(y,()=>A.fps,B,h),l(C,()=>(A.contentLength/1e6).toFixed(2),J,te),le.$$click=()=>{},ve(),b})()})),R}}),g,S),_}})}De(["click"]);const ot=a=>{const n=Ee(),[d,v]=et(),u=()=>!!n.store.subscriptions[a.id];return t(Q,{appearance:"primary",get class(){return a.class},onClick:()=>{u()?n.setStore("subscriptions",a.id,void 0):n.setStore("subscriptions",a.id,{subscribedAt:Date.now(),name:a.name})},get isSelected(){return u()},get label(){return`Subscribe${u()?"d":""}`},get isLoading(){return d.sync.providers.opfs==="connecting"},get isDisabled(){return d.sync.providers.opfs!=="connected"&&d.sync.providers.webrtc!=="connected"}})};var dt=o('<div class="max-w-screen-sm max-h-[80vh] overflow-auto">'),ct=o('<h1 class="text-lg leading-tight font-bold sm:text-xl ">'),ut=o("<img width=42 height=42 class=rounded-full>"),gt=o('<div class="my-1 flex justify-between items-center gap-4 sm:justify-start "><div class="flex max-w-max items-center gap-2 text-sm sm:text-base"><!$><!/><div class="flex flex-col items-start justify-start"><!$><!/><div class="flex w-full items-center text-start text-xs text-text2 sm:text-sm"><!$><!/> subscribers</div></div></div><!$><!/>'),$t=o('<div class="flex flex-col @sm:flex-row items-start @sm:items-center justify-between gap-1 my-1 text-sm "><div class="flex items-center gap-1 @sm:max-w-[16rem] @md:max-w-full"><p class=truncate></p>•<p class=truncate><!$><!/> views</p></div><div class="flex flex-col w-full @sm:w-36 "><div class="flex items-center justify-between"><span class="flex items-center gap-1 "><!$><!/><!$><!/></span><span class="flex items-center gap-1"><!$><!/><!$><!/></span></div><div class="w-full h-1 bg-primary rounded mt-2 flex justify-end"><div class="h-full bg-bg3 rounded-r">'),ft=o('<div class="mt-1 flex flex-col rounded-lg bg-bg2 p-2"><div tabindex=0 id=description></div><div class="w-full h-0 relative"><div class="absolute bottom-full w-full h-5 bg-gradient-to-t from-bg2 to-transparent pointer-events-none"></div></div><button aria-controls=description class="text-center text-sm text-accent1 hover:underline ">Show <!$><!/>'),bt=o('<div class="bg-bg1 p-4 @container"><div class="flex flex-col gap-2"><div class="flex flex-col gap-2 "><div class="flex items-start justify-between h-full"></div><!$><!/></div><!$><!/><!$><!/></div><!$><!/>'),vt=o('<div class="w-full h-96 bg-bg1 animate-pulse">'),mt=o('<div class="w-full h-6 bg-bg2 rounded animate-pulse">'),pt=o('<div class="w-full h-12 flex sm:justify-start justify-between gap-2"><div class="w-44 flex items-center gap-2"><div class="w-12 h-12 aspect-square bg-bg2 animate-pulse rounded-full"></div><div class="flex flex-col justify-between py-1 gap-1 h-full w-full "><div class="w-full h-4 bg-bg2 animate-pulse rounded"></div><div class="w-3/4 h-4 bg-bg2 animate-pulse rounded"></div></div></div><div class="w-32 h-10 bg-bg2 animate-pulse rounded-full">'),ht=o('<div class="w-full h-8 flex flex-wrap gap-2 mb-2 items-end justify-between "><div class="w-64 h-4 bg-bg2 animate-pulse rounded-lg"></div><div class="w-full @sm:w-36 h-4 bg-bg2 animate-pulse rounded-lg">'),_t=o('<div class="mt-1 rounded-lg w-full h-24 bg-bg2 animate-pulse">'),xt=o('<svg class="h-4 w-4 "xmlns=http://www.w3.org/2000/svg fill=currentColor viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1.25 17.292l-4.5-4.364 1.857-1.858 2.643 2.506 5.643-5.784 1.857 1.857-7.5 7.643z">'),wt=o("<div>"),St=o('<div class="flex gap-2 justify-between"><span class=cursor-pointer></span><span></span><!$><!/><span>'),yt=o("<pre>"),Ct=o('<pre class="flex gap-2"><span class=font-bold><!$><!/>:</span> <!$><!/>'),kt=o("<span>"),Dt=o('<div class="flex items-center justify-evenly rounded-full p-2 bg-bg2"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),At=o('<div class="flex items-center bg-bg2 justify-evenly rounded-full p-2 "><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse"></div><div class="w-10 h-10 bg-bg1 rounded-full animate-pulse">');function Ot(a,n,d){const v=document.querySelector("media-player");v.currentTime=parseInt(n,10);const u=new URL(`/watch?v=${a}`,window.location.origin),e=new URLSearchParams(d);e.set("t",n),u.search=e.toString(),history.pushState({},"",u.toString())}globalThis.handleTimestamp=Ot;async function jt(a){const d=(await Me(()=>import("./purify.es-CmEDmnzm.js"),[])).default().sanitize;return d(a).replaceAll(/(?:http(?:s)?:\/\/)?(?:www\.)?youtube\.com(\/[/a-zA-Z0-9_?=&-]*)/gm,"$1").replaceAll(/(?:http(?:s)?:\/\/)?(?:www\.)?youtu\.be\/(?:watch\?v=)?([/a-zA-Z0-9_?=&-]*)/gm,"/watch?v=$1").replaceAll(`
`,"<br>").replace(/<a href="\/watch\?v=([a-zA-Z0-9_?=&-]*)&amp;([^"]*)">([a-zA-Z0-9_?=&-:]*)<\/a>/gm,(u,e,$,D)=>{const _=new URL(`https://youtube.com/watch?v=${e}`),r=new URLSearchParams($),f=new URLSearchParams(window.location.search),U=r.get("t")||"0",m=new URLSearchParams;return r.forEach((g,S)=>{m.set(S,g)}),f.forEach((g,S)=>{m.set(S,g)}),m.forEach((g,S)=>{_.searchParams.set(S,g)}),`<button class="link" onclick="handleTimestamp('${e}','${U}', '${_.search}')">${D}</button>`}).replaceAll(/<a href/gm,'<a class="link" href')}const zt=a=>{const[n]=Ce(),[d]=Ie(),[v,u]=M(void 0);oe(()=>{d.v&&u(d.v)});const e=Ye(()=>({queryKey:["streams",v(),n.instance.api_url],queryFn:()=>at.fetchVideo(v(),n.instance.api_url),enabled:!!(v()&&n.instance.api_url),refetchOnReconnect:!1,refetchOnMount:!1,cacheTime:1/0,staleTime:100*60*1e3,deferStream:!0})),[$,D]=M(!1),[_,r]=M(!1);async function f(b){try{await(await navigator.storage.getDirectory()).removeEntry(b,{recursive:!0})}catch(x){console.error(`Failed to delete ${b}`,x)}}const[U,m]=M(!1),[g,S]=Re(e.data?.uploadDate??new Date);oe(()=>{S(e.data?.uploadDate??new Date)}),Ve(g,{interval:1e3*60});const[R,A]=M(void 0);return oe(async()=>{e.data&&A(await jt(e.data.description))}),[t(ke,{get isOpen(){return U()},setIsOpen:m,title:"Debug info",get children(){return[t(G,{contentSlot:"Copy to clipboard",get triggerSlot(){return t(Q,{as:"div",appearance:"subtle",get icon(){return t(Qe,{class:"w-4 h-4"})}})},onClick:()=>{navigator.clipboard.writeText(JSON.stringify(e.data,null,2))}}),t(q,{get when(){return e.data},get fallback(){return s(vt)},get children(){var b=s(dt);return l(b,t(Oe,{get data(){return e.data},folded:!1})),b}})]}}),t(st,{get id(){return xe(e.data)},get isOpen(){return _()},setIsOpen:r}),(()=>{var b=s(bt),x=b.firstChild,F=x.firstChild,Z=F.firstChild,K=Z.nextSibling,[W,X]=i(K.nextSibling),Y=F.nextSibling,[V,de]=i(Y.nextSibling),ce=V.nextSibling,[ue,ge]=i(ce.nextSibling),$e=x.nextSibling,[ee,fe]=i($e.nextSibling);return l(Z,t(q,{get when(){return e.data},get fallback(){return s(mt)},get children(){var p=s(ct);return l(p,()=>e.data.title),p}})),l(F,t(q,{get when(){return e.data},get fallback(){return s(pt)},get children(){var p=s(gt),w=p.firstChild,P=w.firstChild,[y,z]=i(P.nextSibling),I=y.nextSibling,N=I.firstChild,[B,h]=i(N.nextSibling),C=B.nextSibling,k=C.firstChild,[T,L]=i(k.nextSibling);T.nextSibling;var J=w.nextSibling,[te,le]=i(J.nextSibling);return l(w,t(ye,{class:"link",get href(){return`${e.data.uploaderUrl}`},get children(){var ae=s(ut);return re(O=>{var se=e.data.uploaderAvatar,ie=e.data.uploader;return se!==O.e&&H(ae,"src",O.e=se),ie!==O.t&&H(ae,"alt",O.t=ie),O},{e:void 0,t:void 0}),ae}}),y,z),l(I,t(ye,{get href(){return`${e.data.uploaderUrl}`},class:"link flex w-fit items-center gap-2",get children(){return[E(()=>e.data.uploader)," ",E(()=>E(()=>!!e.data.uploaderVerified)()&&t(Ut,{}))]}}),B,h),l(C,()=>j(e.data.uploaderSubscriberCount).format("0a").toUpperCase(),T,L),l(p,t(ot,{get name(){return e.data.uploader},get id(){return e.data?.uploaderUrl?.split("/channel/")[1]??""}}),te,le),re(()=>H(C,"title",`${e.data.uploaderSubscriberCount} subscribers`)),p}}),W,X),l(x,t(q,{get when(){return e.data},get fallback(){return t(Pt,{})},get children(){return t(Ft,{get downloaded(){return a.downloaded},deleteVideo:()=>f(xe(e.data)),setDownloadModalOpen:()=>r(!0),get refetch(){return e.refetch},setDebugInfoOpen:()=>m(!0)})}}),V,de),l(x,t(q,{get when(){return e.data},get fallback(){return s(ht)},get children(){var p=s($t),w=p.firstChild,P=w.firstChild,y=P.nextSibling,z=y.nextSibling,I=z.firstChild,[N,B]=i(I.nextSibling);N.nextSibling;var h=w.nextSibling,C=h.firstChild,k=C.firstChild,T=k.firstChild,[L,J]=i(T.nextSibling),te=L.nextSibling,[le,ae]=i(te.nextSibling),O=k.nextSibling,se=O.firstChild,[ie,je]=i(se.nextSibling),Ue=ie.nextSibling,[Fe,Pe]=i(Ue.nextSibling),Te=C.nextSibling,me=Te.firstChild;return l(P,()=>{const c=g().toString().split(":")[0],ne=g().toString().split(" ")[4];return`${c.slice(0,c.length-3)} ${ne.slice(0,ne.length-3)}`}),l(z,(()=>{var c=E(()=>e.data.views>1e4);return()=>c()?j(e.data.views).format("0.00a").toUpperCase():j(e.data.views).format("0,0").toUpperCase()})(),N,B),l(k,t(tt,{class:"w-5 h-5 text-text2"}),L,J),l(k,(()=>{var c=E(()=>e.data.likes>1e3);return()=>c()?j(e.data.likes).format("0.0a").toUpperCase():j(e.data.likes).format("0,0").toUpperCase()})(),le,ae),l(O,t(lt,{class:"h-5 w-5 text-text2 ",fill:"currentColor"}),ie,je),l(O,(()=>{var c=E(()=>e.data.dislikes>1e3);return()=>c()?j(e.data.dislikes).format("0.0a").toUpperCase():j(e.data.dislikes).format("0,0").toUpperCase()})(),Fe,Pe),re(c=>{var ne=`Published ${(()=>{const _e=g().toString().split(":")[0];return _e.slice(0,_e.length-3)})()} • ${j(e.data.views).format("0,0")} views`,pe=`${j(e.data.likes).format("0,0")} likes`,he=`${j(e.data.dislikes).format("0,0")} likes`,be=`${e.data.dislikes/(e.data.likes+e.data.dislikes)*100}%`;return ne!==c.e&&H(p,"title",c.e=ne),pe!==c.t&&H(k,"title",c.t=pe),he!==c.a&&H(O,"title",c.a=he),be!==c.o&&((c.o=be)!=null?me.style.setProperty("width",be):me.style.removeProperty("width")),c},{e:void 0,t:void 0,a:void 0,o:void 0}),p}}),ue,ge),l(b,t(q,{get when(){return e.data},get fallback(){return s(_t)},get children(){var p=s(ft),w=p.firstChild,P=w.nextSibling,y=P.nextSibling,z=y.firstChild,I=z.nextSibling,[N,B]=i(I.nextSibling);return y.$$click=()=>{D(!$())},l(y,()=>$()?"less":"more",N,B),re(h=>{var C=$(),k=`min-w-0 max-w-full overflow-hidden ${$()?"":"max-h-20"}`,T=R(),L=!!$();return C!==h.e&&H(w,"aria-expanded",h.e=C),k!==h.t&&Ae(w,h.t=k),T!==h.a&&Ne(w,"innerHTML",h.a=T),L!==h.o&&P.classList.toggle("hidden",h.o=L),h},{e:void 0,t:void 0,a:void 0,o:void 0}),ve(),p}}),ee,fe),b})()]},Ut=()=>s(xt),Oe=a=>{const[n,d]=M(a.folded),v=typeof a.data=="object"&&a.data!==null;return(()=>{var u=s(wt);return l(u,v?(()=>{var e=s(St),$=e.firstChild,D=$.nextSibling,_=D.nextSibling,[r,f]=i(_.nextSibling),U=r.nextSibling;return $.$$click=()=>d(!n()),l($,(()=>{var m=E(()=>!!n());return()=>m()?t(qe,{}):t(Ze,{})})()),l(D,()=>Array.isArray(a.data)?"[":"{"),l(e,(()=>{var m=E(()=>!n());return()=>m()?(()=>{var g=s(yt);return l(g,()=>Object.entries(a.data).map(([S,R],A)=>(()=>{var b=s(Ct),x=b.firstChild,F=x.firstChild,[Z,K]=i(F.nextSibling);Z.nextSibling;var W=x.nextSibling,X=W.nextSibling,[Y,V]=i(X.nextSibling);return l(x,S,Z,K),l(b,t(Oe,{data:R,get level(){return(a.level||0)+1},folded:!0}),Y,V),b})())),g})():"..."})(),r,f),l(U,()=>Array.isArray(a.data)?"]":"}"),ve(),e})():(()=>{var e=s(kt);return l(e,()=>a.data),e})()),re(()=>Ae(u,`pl-${a.level||1} flex text-xs font-mono`)),u})()},Ft=a=>(()=>{var n=s(Dt),d=n.firstChild,[v,u]=i(d.nextSibling),e=v.nextSibling,[$,D]=i(e.nextSibling),_=$.nextSibling,[r,f]=i(_.nextSibling),U=r.nextSibling,[m,g]=i(U.nextSibling),S=m.nextSibling,[R,A]=i(S.nextSibling);return l(n,t(Be,{get children(){return[t(Se,{get when(){return a.downloaded},get children(){return t(G,{as:"div",contentSlot:"Delete",get triggerSlot(){return t(Q,{get icon(){return t(He,{class:"h-6 w-6"})},appearance:"subtle",get onClick(){return a.deleteVideo}})}})}}),t(Se,{get when(){return!a.downloaded},get children(){return t(G,{as:"div",contentSlot:"Download",get triggerSlot(){return t(Q,{get icon(){return t(Ge,{class:"h-6 w-6"})},appearance:"subtle",get onClick(){return a.setDownloadModalOpen}})}})}})]}}),v,u),l(n,t(G,{as:"div",contentSlot:"Share",get triggerSlot(){return t(Q,{get icon(){return t(Je,{class:"h-6 w-6"})},appearance:"subtle",onClick:()=>{we.show("Not implemented")}})}}),$,D),l(n,t(G,{as:"div",contentSlot:"Save",get triggerSlot(){return t(Q,{get icon(){return t(Ke,{class:"h-6 w-6"})},appearance:"subtle",onClick:()=>{we.show("Not implemented")}})}}),r,f),l(n,t(G,{as:"div",contentSlot:"Debug info",get triggerSlot(){return t(Q,{get icon(){return t(We,{class:"h-6 w-6"})},appearance:"subtle",get onClick(){return a.setDebugInfoOpen}})}}),m,g),l(n,t(G,{as:"div",contentSlot:"Soft Refresh (Shift+R)",get triggerSlot(){return t(Q,{get icon(){return t(Xe,{class:"h-6 w-6"})},appearance:"subtle",get onClick(){return a.refetch}})}}),R,A),n})(),Pt=()=>s(At);De(["click"]);export{Ut as C,zt as D,ot as S,at as a,jt as s};
//# sourceMappingURL=Description-BLDREoDG.js.map
